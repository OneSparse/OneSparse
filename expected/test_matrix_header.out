\pset linestyle unicode
\pset border 2
-- # Matrix
--
-- This documentation is also tests for the code, the examples below
-- show the literal output of these statements from Postgres.
--
-- Some setup to make sure the extension is installed.
set client_min_messages = 'WARNING'; -- pragma:hide
create extension if not exists onesparse;
\o /dev/null
\set ECHO none
\o
-- OneSparse wraps the
-- [SuiteSparse:GraphBLAS](http://faculty.cse.tamu.edu/davis/GraphBLAS.html)
-- library and extends Postgres by adding new types and functions that
-- allow you to do sparse and dense linear algebra in Postgres.  This
-- is similar to functionality packages like `numpy` and
-- `scipy.sparse` bring to Python.
--
-- While a full grasp of the GraphBLAS API is not necessary to follow
-- along with this guide there are many details that are not spelled
-- out in great details here.  For complete details on the API and
-- expected behaviors, see the [SuiteSparse:GraphBLAS User
-- Guide](https://github.com/DrTimothyAldenDavis/SuiteSparse/blob/dev/GraphBLAS/Doc/GraphBLAS_UserGuide.pdf).
--
-- The most fundamenteal object in OneSparse is a Matrix.  A Matrix is
-- a two dimensional array of data with a certain number of rows *m*
-- and columns *n*.  Typically matrices are very memory hungry data
-- structures, requiring `m * n` memory to hold all of the elements.
--
-- This limits traditional matrix libraries, because many problems in
-- linear algebra are *sparse*.  Not every element is used in the
-- problem or even definable.  Traditional linear algebra libraries
-- usually encode sparse matrices into dense matrices by using the
-- number zero to indicate "nothing", but this approach does not solve
-- the memory problem.  For matrices with a large number of rows and
-- columns this means vast areas of memories filled with zeros that
-- end up being multiplied away, which also wastes time and energy.
--
-- OneSparse matrices however are smart, and can adapt to the number
-- of actually useful elements in a Matrix.  They can be dense or
-- sparse, the SuiteSparse library will adapt to choose the right
-- backend format.
--
-- ## Matrices and Graphs
--
-- Every matrix is a graph, whether you think of it that way or not.
-- And every graph has a corresponding matrix.  A lot of data that you
-- put into postgres tables can also describe a graph, and thus a
-- matrix.  These three different ways of thinking about tables,
-- graphs, and matrices is one of the core concepts of OneSparse:
--
-- ![Tables, Graphs, and Matrices](./table_graph_matrix.png)
--
-- While SuiteSparse is optimized for processing sparse matrices and
-- vectors, it also supports optimized kernels for dense objects.  A
-- dense matrix is just a sparse matrix with all its elements.  In
-- this case SuiteSparse will automatically store it in a dense
-- optimal format and use CPUs or GPUs appropriately to process them.
--
-- ## Getting Started
--
-- The examples below are all what you would see typing the exact
-- queries out in `psql`.  The GraphBLAS API is large, so onesparse is
-- always contained in the `onesparse` postgres schema.  For the sake
-- of brevity, let's set the `search_path` so that we can just type
-- `matrix` instead of `onesparse.matrix` everywhere.
SET search_path TO public,onesparse;
-- If the matrix has bounds, it can be printed to the console if they
-- are reasonable size, this is useful for debugging and
-- experimentation:
--
select print('int32(4:4)'::matrix);
┌────────────────────┐
│       print        │
├────────────────────┤
│      0  1  2  3   ↵│
│    ────────────   ↵│
│  0│               ↵│
│  1│               ↵│
│  2│               ↵│
│  3│               ↵│
│                    │
└────────────────────┘
(1 row)

-- Note that this matrix is empty, it's not filled with "zeros", it
-- contains *no elements*.  The memory needed to hold the matrix
-- contains only stored elements, if there isn't a value stored at a
-- given row or column position, no memory is consumed.  This is the
-- "sparse" in sparse matrix.  This is how it's possible to create an
-- unbounded row by unbounded column matrix without exhausting memory
-- trying to allocate `2^120` entries.
--
-- ## Drawing Matrices and Vectors
--
-- The `draw()` function turns a matrix into the Graphviz DOT language
-- that is used to draw graph diagrams:
select draw('int32(4:4)[1:2:1 2:3:2 3:1:3]'::matrix) as draw;
┌───────────────────────┐
│         draw          │
├───────────────────────┤
│ digraph {            ↵│
│  node [shape=circle];↵│
│  rankdir=LR;         ↵│
│ 1 -> 2 [label="1" ]; ↵│
│ 2 -> 3 [label="2" ]; ↵│
│ 3 -> 1 [label="3" ]; ↵│
│ }                    ↵│
│                       │
└───────────────────────┘
(1 row)

-- Will generate the following diagram:
select draw('int32(4:4)[1:2:1 2:3:2 3:1:3]'::matrix) as draw_source \gset
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="185pt" height="66pt"
--  viewBox="0.00 0.00 185.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 181.34,-62.11 181.34,4 -4,4"/>
-- <!-- 1 -->
-- <g id="node1" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2 -->
-- <g id="node2" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-42.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-40.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge1" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.27,-20.76C39.91,-24.42 53.05,-29.41 64.32,-33.69"/>
-- <polygon fill="black" stroke="black" points="63.41,-37.09 74,-37.37 65.89,-30.54 63.41,-37.09"/>
-- <text text-anchor="middle" x="52.11" y="-33.16" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="161.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="161.78" y="-13.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge2" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M103.38,-37.35C113.02,-33.69 126.16,-28.7 137.44,-24.42"/>
-- <polygon fill="black" stroke="black" points="139.01,-27.57 147.11,-20.75 136.52,-21.02 139.01,-27.57"/>
-- <text text-anchor="middle" x="125.23" y="-33.16" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>3&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M145.94,-13.21C134.56,-11.54 118.45,-9.43 104.23,-8.56 90.42,-7.71 86.91,-7.71 73.11,-8.56 62.67,-9.2 51.2,-10.51 41.34,-11.82"/>
-- <polygon fill="black" stroke="black" points="40.81,-8.36 31.39,-13.21 41.78,-15.29 40.81,-8.36"/>
-- <text text-anchor="middle" x="88.67" y="-11.16" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
-- Let's look at our cast of test objects for the remaining examples.
-- These objects from the `onesparse.test_fixture` table.
\x
select * from test_fixture;
┌─[ RECORD 1 ]─┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ t            │ int32                                                                                                       │
│ a            │ int8(4:4)[   ]                                                                                              │
│ b            │ int8(4:4)[    ]                                                                                             │
│ d            │ int32(4:4)[0:0:1 0:1:1 0:2:1 0:3:1 1:0:1 1:1:1 1:2:1 1:3:1 2:0:1 2:1:1 2:2:1 2:3:1 3:0:1 3:1:1 3:2:1 3:3:1] │
│ s            │ int32(2:2)[0:0:1 0:1:1 1:1:1]                                                                               │
│ u            │ int32(4)[1:2]                                                                                               │
│ v            │ int32(4)[1:3 2:3]                                                                                           │
│ unaryop      │ ainv_int32                                                                                                  │
│ indexunaryop │ valuegt_int32                                                                                               │
│ binaryop     │ times_int32                                                                                                 │
│ monoid       │ plus_monoid_int32                                                                                           │
│ semiring     │ plus_times_int32                                                                                            │
└──────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

\x
--
-- Here are a couple of sparse matrices from the test_fixture table.
-- We'll call them `a` and `b` in these docs:
--
select print(a) as a, print(b) as b from test_fixture;
┌────────────────────┬────────────────────┐
│         a          │         b          │
├────────────────────┼────────────────────┤
│      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│    ────────────   ↵│
│  0│ 36 21         ↵│  0│    55         ↵│
│  1│       40      ↵│  1│-67-71         ↵│
│  2│   127         ↵│  2│               ↵│
│  3│               ↵│  3│-77   -10      ↵│
│                    │                    │
└────────────────────┴────────────────────┘
(1 row)

select draw(a) as twocol_a_source, draw(b) as twocol_b_source from test_fixture \gset
\i sql/twocol.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :twocol_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :twocol_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- Here are some sparse test vectors, they will be used for some of
-- the examples below:
--
select print(u) as u, print(v) as v from test_fixture;
┌───────────┬───────────┐
│     u     │     v     │
├───────────┼───────────┤
│          ↵│          ↵│
│    ───   ↵│    ───   ↵│
│  0│      ↵│  0│      ↵│
│  1│  2   ↵│  1│  3   ↵│
│  2│      ↵│  2│  3   ↵│
│  3│      ↵│  3│      ↵│
│           │           │
└───────────┴───────────┘
(1 row)

select draw(u) as twocol_a_source, draw(v) as twocol_b_source from test_fixture \gset
\i sql/twocol.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :twocol_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="70pt" height="177pt"
--  viewBox="0.00 0.00 70.00 177.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 173)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-173 66,-173 66,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-161 54,-161 54,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="33,-153 29,-153 29,-149 33,-149 33,-153"/>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="46,-113 16,-113 16,-96 46,-96 46,-113"/>
-- <text text-anchor="middle" x="31" y="-102.6" font-family="Times,serif" font-size="8.00">1:2</text>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="33,-60 29,-60 29,-56 33,-56 33,-60"/>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="33,-20 29,-20 29,-16 33,-16 33,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :twocol_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="70pt" height="190pt"
--  viewBox="0.00 0.00 70.00 190.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 186)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-186 66,-186 66,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-174 54,-174 54,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="33,-166 29,-166 29,-162 33,-162 33,-166"/>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="46,-126 16,-126 16,-109 46,-109 46,-126"/>
-- <text text-anchor="middle" x="31" y="-115.6" font-family="Times,serif" font-size="8.00">1:3</text>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="46,-73 16,-73 16,-56 46,-56 46,-73"/>
-- <text text-anchor="middle" x="31" y="-62.6" font-family="Times,serif" font-size="8.00">2:3</text>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="33,-20 29,-20 29,-16 33,-16 33,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- There is also an example "dense" matrix named 'd':
--
select print(d) from test_fixture;
┌────────────────────┐
│       print        │
├────────────────────┤
│      0  1  2  3   ↵│
│    ────────────   ↵│
│  0│  1  1  1  1   ↵│
│  1│  1  1  1  1   ↵│
│  2│  1  1  1  1   ↵│
│  3│  1  1  1  1   ↵│
│                    │
└────────────────────┘
(1 row)

-- One way of thinking about a "dense" matrix is a fully connected
-- graph, these can be constructed with the `dense_matrix()` function:
--
select draw(dense_matrix(4, 4, 1)) as draw_source from test_fixture \gset
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="258pt" height="179pt"
--  viewBox="0.00 0.00 258.45 179.30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 175.3)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-175.3 254.45,-175.3 254.45,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-23.3" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-21.4" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.4,-37.79C7.67,-47.45 9.72,-56.86 15.56,-56.86 19.2,-56.86 21.37,-53.18 22.06,-48.07"/>
-- <polygon fill="black" stroke="black" points="25.55,-47.66 21.71,-37.79 18.56,-47.9 25.55,-47.66"/>
-- <text text-anchor="middle" x="15.56" y="-59.46" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-111.3" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-109.4" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M20.95,-37.9C25.89,-52.36 35.1,-74.42 49.11,-89.3 53.51,-93.97 59.13,-97.93 64.71,-101.15"/>
-- <polygon fill="black" stroke="black" points="63.34,-104.39 73.83,-105.86 66.55,-98.17 63.34,-104.39"/>
-- <text text-anchor="middle" x="52.11" y="-95.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="234.89" cy="-51.3" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="234.89" y="-49.4" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 0&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>0&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.68,-19.04C36.35,-17.54 42.99,-16.04 49.11,-15.3 105.9,-8.43 122.08,-11.52 177.34,-26.3 188.2,-29.21 190.99,-29.91 201.34,-34.3 204.89,-35.81 208.59,-37.56 212.16,-39.34"/>
-- <polygon fill="black" stroke="black" points="210.65,-42.5 221.13,-44.03 213.89,-36.3 210.65,-42.5"/>
-- <text text-anchor="middle" x="125.23" y="-17.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3 -->
-- <g id="node4" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="161.78" cy="-51.3" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="161.78" y="-49.4" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 0&#45;&gt;3 -->
-- <g id="edge4" class="edge">
-- <title>0&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M30.91,-26.09C55.41,-30.84 105.56,-40.58 135.87,-46.46"/>
-- <polygon fill="black" stroke="black" points="135.57,-49.97 146.05,-48.44 136.9,-43.1 135.57,-49.97"/>
-- <text text-anchor="middle" x="88.67" y="-42.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M78.23,-99.62C66.57,-85.2 46.57,-60.44 32.51,-43.04"/>
-- <polygon fill="black" stroke="black" points="35.15,-40.75 26.15,-35.17 29.71,-45.15 35.15,-40.75"/>
-- <text text-anchor="middle" x="52.11" y="-71.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge6" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M82.51,-125.79C80.78,-135.45 82.83,-144.86 88.67,-144.86 92.32,-144.86 94.49,-141.18 95.18,-136.07"/>
-- <polygon fill="black" stroke="black" points="98.66,-135.66 94.82,-125.79 91.67,-135.9 98.66,-135.66"/>
-- <text text-anchor="middle" x="88.67" y="-147.46" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge7" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M97.1,-124.88C102.72,-133.64 111.33,-144.29 122.23,-149.3 154.17,-164 172.82,-169.87 201.34,-149.3 223.93,-133 231.09,-100.38 233.23,-77.26"/>
-- <polygon fill="black" stroke="black" points="236.73,-77.3 233.91,-67.09 229.75,-76.84 236.73,-77.3"/>
-- <text text-anchor="middle" x="161.78" y="-164.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;3 -->
-- <g id="edge8" class="edge">
-- <title>1&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M103.24,-105.01C110.98,-101.08 120.62,-95.58 128.23,-89.3 134.49,-84.13 140.52,-77.66 145.65,-71.54"/>
-- <polygon fill="black" stroke="black" points="148.52,-73.56 152.03,-63.56 143.05,-69.19 148.52,-73.56"/>
-- <text text-anchor="middle" x="125.23" y="-95.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;0 -->
-- <g id="edge9" class="edge">
-- <title>2&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M222.07,-42.43C215.99,-38.01 208.39,-32.68 201.34,-28.3 171.91,-10.03 162.53,-6.09 128.23,-1.3 97.48,3 62.41,-6.27 39.91,-14.07"/>
-- <polygon fill="black" stroke="black" points="38.42,-10.88 30.23,-17.6 40.82,-17.46 38.42,-10.88"/>
-- <text text-anchor="middle" x="125.23" y="-3.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge10" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M224.61,-63.64C214.49,-76.05 197.09,-94.54 177.34,-103.3 157.46,-112.11 132.6,-113.6 114.43,-113.18"/>
-- <polygon fill="black" stroke="black" points="114.49,-109.68 104.34,-112.74 114.18,-116.68 114.49,-109.68"/>
-- <text text-anchor="middle" x="161.78" y="-113.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;2 -->
-- <g id="edge11" class="edge">
-- <title>2&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M228.74,-65.79C227.01,-75.45 229.06,-84.86 234.89,-84.86 238.54,-84.86 240.71,-81.18 241.4,-76.07"/>
-- <polygon fill="black" stroke="black" points="244.89,-75.66 241.05,-65.79 237.89,-75.9 244.89,-75.66"/>
-- <text text-anchor="middle" x="234.89" y="-87.46" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge12" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M219.18,-51.3C210.12,-51.3 198.28,-51.3 187.79,-51.3"/>
-- <polygon fill="black" stroke="black" points="187.52,-47.8 177.52,-51.3 187.52,-54.8 187.52,-47.8"/>
-- <text text-anchor="middle" x="198.34" y="-53.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge13" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M148.44,-42.78C137.41,-35.72 120.53,-26.24 104.23,-22.3 83.4,-17.27 58.96,-18.08 41.19,-19.82"/>
-- <polygon fill="black" stroke="black" points="40.61,-16.36 31.07,-20.98 41.41,-23.32 40.61,-16.36"/>
-- <text text-anchor="middle" x="88.67" y="-24.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3&#45;&gt;1 -->
-- <g id="edge14" class="edge">
-- <title>3&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M148.69,-59.84C140.95,-65.44 130.79,-73.05 122.23,-80.3 117.34,-84.44 112.25,-89.11 107.58,-93.54"/>
-- <polygon fill="black" stroke="black" points="104.99,-91.18 100.23,-100.64 109.85,-96.21 104.99,-91.18"/>
-- <text text-anchor="middle" x="125.23" y="-82.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge15" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M176.06,-44.67C181.83,-42.14 188.76,-39.56 195.34,-38.3 200.75,-37.26 206.44,-38.06 211.74,-39.68"/>
-- <polygon fill="black" stroke="black" points="210.69,-43.03 221.28,-43.52 213.31,-36.54 210.69,-43.03"/>
-- <text text-anchor="middle" x="198.34" y="-40.9" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3&#45;&gt;3 -->
-- <g id="edge16" class="edge">
-- <title>3&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M155.63,-65.79C153.89,-75.45 155.95,-84.86 161.78,-84.86 165.43,-84.86 167.6,-81.18 168.29,-76.07"/>
-- <polygon fill="black" stroke="black" points="171.78,-75.66 167.94,-65.79 164.78,-75.9 171.78,-75.66"/>
-- <text text-anchor="middle" x="161.78" y="-87.46" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
-- And another matrix named 's' which is a Sierpinsky Graph, which
-- we'll show off a bit later.
--
select print(s) from test_fixture;
┌──────────────┐
│    print     │
├──────────────┤
│      0  1   ↵│
│    ──────   ↵│
│  0│  1  1   ↵│
│  1│     1   ↵│
│              │
└──────────────┘
(1 row)

-- ## Random Matrices
--
-- `random_matrix` will generate a random matrix provided the type,
-- number of rows, number of columns, and the number of (approximate)
-- values, an optional max value, and an optional random seed for
-- deterministic generation:
select print(random_matrix('uint8', 8, 8, 1, 42)) as random_matrix;
┌────────────────────────────────┐
│         random_matrix          │
├────────────────────────────────┤
│      0  1  2  3  4  5  6  7   ↵│
│    ────────────────────────   ↵│
│  0│ 65251126            179   ↵│
│  1│190    67233 85 24   107   ↵│
│  2│    84 62213123  5         ↵│
│  3│ 56108 27211 15136140205   ↵│
│  4│ 31     9104104107149      ↵│
│  5│114126 52 64 16    68254   ↵│
│  6│ 76       31   143         ↵│
│  7│   226231    68 35   160   ↵│
│                                │
└────────────────────────────────┘
(1 row)

-- This random matrix is also a random *graph*:
--
select draw(random_matrix('uint8', 8, 8, 1, 42)) as draw_source \gset
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="621pt" height="796pt"
--  viewBox="0.00 0.00 620.90 796.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 792)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-792 616.9,-792 616.9,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-537" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-535.1" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M8.79,-551.14C6.74,-560.92 8.99,-570.56 15.56,-570.56 19.76,-570.56 22.2,-566.6 22.87,-561.19"/>
-- <polygon fill="black" stroke="black" points="26.36,-560.93 22.32,-551.14 19.37,-561.31 26.36,-560.93"/>
-- <text text-anchor="middle" x="15.56" y="-573.16" font-family="Times,serif" font-size="8.00">65</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="98.67" cy="-249" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="98.67" y="-247.1" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M20.28,-521.82C26.14,-498.1 38,-450.83 49.11,-411 62.79,-361.96 80.22,-305.03 90.04,-273.4"/>
-- <polygon fill="black" stroke="black" points="93.43,-274.28 93.06,-263.69 86.75,-272.2 93.43,-274.28"/>
-- <text text-anchor="middle" x="57.11" y="-413.6" font-family="Times,serif" font-size="8.00">251</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="597.35" cy="-371" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="597.35" y="-369.1" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 0&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>0&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M18.33,-552.51C24.85,-605.92 49.7,-779 97.67,-779 97.67,-779 97.67,-779 515.23,-779 593.49,-779 597.38,-486.62 596.73,-396.88"/>
-- <polygon fill="black" stroke="black" points="600.23,-396.71 596.63,-386.74 593.23,-396.78 600.23,-396.71"/>
-- <text text-anchor="middle" x="306.45" y="-781.6" font-family="Times,serif" font-size="8.00">126</text>
-- </g>
-- <!-- 7 -->
-- <g id="node4" class="node">
-- <title>7</title>
-- <ellipse fill="none" stroke="black" cx="431.12" cy="-240" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="431.12" y="-238.1" font-family="Times,serif" font-size="8.00">7</text>
-- </g>
-- <!-- 0&#45;&gt;7 -->
-- <g id="edge4" class="edge">
-- <title>0&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M17.25,-521.43C21.37,-433.88 44.2,-7 97.67,-7 97.67,-7 97.67,-7 224.34,-7 290.71,-7 315.68,-15.04 363.56,-61 407,-102.69 422.3,-175.29 427.53,-213.98"/>
-- <polygon fill="black" stroke="black" points="424.11,-214.88 428.8,-224.38 431.06,-214.03 424.11,-214.88"/>
-- <text text-anchor="middle" x="223.34" y="-9.6" font-family="Times,serif" font-size="8.00">179</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M95.82,-264.35C91.95,-294.59 81.92,-363.83 65.11,-420 55.02,-453.74 38.55,-491.04 27.64,-514.26"/>
-- <polygon fill="black" stroke="black" points="24.48,-512.76 23.34,-523.29 30.8,-515.77 24.48,-512.76"/>
-- <text text-anchor="middle" x="57.11" y="-464.6" font-family="Times,serif" font-size="8.00">190</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge6" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M100.13,-233.38C102.27,-192.06 114.22,-83 180.78,-83 180.78,-83 180.78,-83 307.45,-83 413.65,-83 509.11,-201.04 563.79,-281 577.4,-300.9 586.04,-327.16 590.97,-346.18"/>
-- <polygon fill="black" stroke="black" points="587.58,-347.02 593.34,-355.91 594.38,-345.37 587.58,-347.02"/>
-- <text text-anchor="middle" x="348.01" y="-95.6" font-family="Times,serif" font-size="8.00">67</text>
-- </g>
-- <!-- 1&#45;&gt;7 -->
-- <g id="edge10" class="edge">
-- <title>1&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M110.63,-238.84C116.72,-233.46 124.6,-226.97 132.23,-222 177.52,-192.45 195.51,-194.13 249.34,-189 308.43,-183.36 374.89,-211.53 408.36,-228.28"/>
-- <polygon fill="black" stroke="black" points="406.78,-231.4 417.27,-232.86 409.98,-225.17 406.78,-231.4"/>
-- <text text-anchor="middle" x="264.89" y="-191.6" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 3 -->
-- <g id="node5" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="348.01" cy="-383" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="348.01" y="-381.1" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 1&#45;&gt;3 -->
-- <g id="edge7" class="edge">
-- <title>1&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M112.53,-241.75C149.25,-222.12 255.66,-172.83 314.45,-225 333.83,-242.2 342.2,-317.08 345.36,-357.27"/>
-- <polygon fill="black" stroke="black" points="341.88,-357.66 346.1,-367.38 348.86,-357.15 341.88,-357.66"/>
-- <text text-anchor="middle" x="223.34" y="-207.6" font-family="Times,serif" font-size="8.00">233</text>
-- </g>
-- <!-- 4 -->
-- <g id="node6" class="node">
-- <title>4</title>
-- <ellipse fill="none" stroke="black" cx="514.23" cy="-459" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="514.23" y="-457.1" font-family="Times,serif" font-size="8.00">4</text>
-- </g>
-- <!-- 1&#45;&gt;4 -->
-- <g id="edge8" class="edge">
-- <title>1&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M103,-264.34C108.42,-288.8 119.8,-338.03 132.23,-379 175.08,-520.26 195.95,-587.79 332.45,-644 359.66,-655.2 372.03,-670.62 397.56,-656 463.07,-618.5 495.1,-527.89 507.23,-483.85"/>
-- <polygon fill="black" stroke="black" points="510.67,-484.53 509.83,-473.96 503.9,-482.74 510.67,-484.53"/>
-- <text text-anchor="middle" x="306.45" y="-637.6" font-family="Times,serif" font-size="8.00">85</text>
-- </g>
-- <!-- 5 -->
-- <g id="node7" class="node">
-- <title>5</title>
-- <ellipse fill="none" stroke="black" cx="181.78" cy="-449" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="181.78" y="-447.1" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 1&#45;&gt;5 -->
-- <g id="edge9" class="edge">
-- <title>1&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M105.37,-263.06C119.13,-296.99 154.26,-383.61 171.27,-425.54"/>
-- <polygon fill="black" stroke="black" points="168.08,-427 175.08,-434.95 174.57,-424.37 168.08,-427"/>
-- <text text-anchor="middle" x="140.23" y="-368.6" font-family="Times,serif" font-size="8.00">24</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge11" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M596.32,-355.06C595.8,-284.05 589.08,0 515.23,0 388.56,0 388.56,0 388.56,0 328.12,0 171.92,-45.41 132.23,-91 115.29,-110.45 105.87,-183.7 101.92,-223.27"/>
-- <polygon fill="black" stroke="black" points="98.41,-223.17 100.95,-233.46 105.38,-223.84 98.41,-223.17"/>
-- <text text-anchor="middle" x="348.01" y="-9.6" font-family="Times,serif" font-size="8.00">84</text>
-- </g>
-- <!-- 2&#45;&gt;2 -->
-- <g id="edge12" class="edge">
-- <title>2&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M590.58,-385.14C588.53,-394.92 590.78,-404.56 597.35,-404.56 601.55,-404.56 603.99,-400.6 604.66,-395.19"/>
-- <polygon fill="black" stroke="black" points="608.15,-394.93 604.11,-385.14 601.16,-395.31 608.15,-394.93"/>
-- <text text-anchor="middle" x="597.35" y="-407.16" font-family="Times,serif" font-size="8.00">62</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge13" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M588.15,-358.43C582.31,-350.49 573.74,-340.68 563.79,-335 524.97,-312.84 509.06,-312.74 464.68,-318 426.95,-322.48 413.13,-316.85 381.56,-338 373.18,-343.62 366.21,-352.16 360.9,-360.3"/>
-- <polygon fill="black" stroke="black" points="357.75,-358.75 355.63,-369.13 363.76,-362.34 357.75,-358.75"/>
-- <text text-anchor="middle" x="472.68" y="-320.6" font-family="Times,serif" font-size="8.00">213</text>
-- </g>
-- <!-- 2&#45;&gt;4 -->
-- <g id="edge14" class="edge">
-- <title>2&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M583.3,-378.42C572.85,-384.79 558.26,-394.73 547.79,-406 539.55,-414.87 532.28,-426.15 526.71,-436.01"/>
-- <polygon fill="black" stroke="black" points="523.58,-434.45 521.92,-444.91 529.74,-437.77 523.58,-434.45"/>
-- <text text-anchor="middle" x="555.79" y="-408.6" font-family="Times,serif" font-size="8.00">123</text>
-- </g>
-- <!-- 2&#45;&gt;5 -->
-- <g id="edge15" class="edge">
-- <title>2&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M594.22,-386.53C586.8,-437.59 560.05,-597 515.23,-597 388.56,-597 388.56,-597 388.56,-597 302.41,-597 277.01,-570.16 215.34,-510 204.87,-499.78 196.99,-485.47 191.6,-473.27"/>
-- <polygon fill="black" stroke="black" points="194.7,-471.59 187.67,-463.67 188.22,-474.25 194.7,-471.59"/>
-- <text text-anchor="middle" x="389.56" y="-599.6" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 7&#45;&gt;1 -->
-- <g id="edge40" class="edge">
-- <title>7&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M426.67,-225.03C418.71,-194.73 396.03,-129 349.01,-129 180.78,-129 180.78,-129 180.78,-129 135.43,-129 113.72,-188.55 104.85,-223.75"/>
-- <polygon fill="black" stroke="black" points="101.37,-223.27 102.5,-233.8 108.19,-224.86 101.37,-223.27"/>
-- <text text-anchor="middle" x="264.89" y="-131.6" font-family="Times,serif" font-size="8.00">226</text>
-- </g>
-- <!-- 7&#45;&gt;2 -->
-- <g id="edge41" class="edge">
-- <title>7&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M446.75,-242.67C473.36,-248.24 530.05,-263.46 563.79,-297 577.26,-310.39 585.59,-330.31 590.45,-346.11"/>
-- <polygon fill="black" stroke="black" points="587.09,-347.1 593.15,-355.79 593.83,-345.21 587.09,-347.1"/>
-- <text text-anchor="middle" x="514.23" y="-274.6" font-family="Times,serif" font-size="8.00">231</text>
-- </g>
-- <!-- 7&#45;&gt;7 -->
-- <g id="edge44" class="edge">
-- <title>7&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M424.35,-254.14C422.3,-263.92 424.56,-273.56 431.12,-273.56 435.32,-273.56 437.76,-269.6 438.43,-264.19"/>
-- <polygon fill="black" stroke="black" points="441.92,-263.93 437.89,-254.14 434.93,-264.31 441.92,-263.93"/>
-- <text text-anchor="middle" x="431.12" y="-276.16" font-family="Times,serif" font-size="8.00">160</text>
-- </g>
-- <!-- 7&#45;&gt;4 -->
-- <g id="edge42" class="edge">
-- <title>7&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M434.57,-255.23C438.67,-278.44 448.16,-323.69 464.68,-359 469.95,-370.28 474.66,-371.1 480.68,-382 490.1,-399.1 498.61,-419.49 504.57,-434.99"/>
-- <polygon fill="black" stroke="black" points="501.3,-436.26 508.09,-444.39 507.86,-433.8 501.3,-436.26"/>
-- <text text-anchor="middle" x="472.68" y="-384.6" font-family="Times,serif" font-size="8.00">68</text>
-- </g>
-- <!-- 7&#45;&gt;5 -->
-- <g id="edge43" class="edge">
-- <title>7&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M416.6,-246.2C379.96,-263.56 277.41,-316 215.34,-386 205.22,-397.41 197.27,-412.53 191.76,-425.1"/>
-- <polygon fill="black" stroke="black" points="188.46,-423.93 187.87,-434.51 194.92,-426.61 188.46,-423.93"/>
-- <text text-anchor="middle" x="306.45" y="-316.6" font-family="Times,serif" font-size="8.00">35</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge16" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M343.73,-398.12C330.83,-455.56 281.54,-657 224.34,-657 97.67,-657 97.67,-657 97.67,-657 52.32,-657 30.61,-597.45 21.74,-562.25"/>
-- <polygon fill="black" stroke="black" points="25.07,-561.14 19.39,-552.2 18.26,-562.73 25.07,-561.14"/>
-- <text text-anchor="middle" x="181.78" y="-659.6" font-family="Times,serif" font-size="8.00">56</text>
-- </g>
-- <!-- 3&#45;&gt;1 -->
-- <g id="edge17" class="edge">
-- <title>3&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M333.89,-375.89C293.68,-354.11 171.87,-288.11 121.66,-260.91"/>
-- <polygon fill="black" stroke="black" points="123.08,-257.7 112.62,-256.02 119.74,-263.86 123.08,-257.7"/>
-- <text text-anchor="middle" x="223.34" y="-322.6" font-family="Times,serif" font-size="8.00">108</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge18" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M362.98,-377.64C384.45,-369.72 427.04,-355.26 464.68,-350 502.56,-344.7 546.39,-354.99 572.71,-362.95"/>
-- <polygon fill="black" stroke="black" points="571.94,-366.38 582.53,-366.07 574.06,-359.71 571.94,-366.38"/>
-- <text text-anchor="middle" x="472.68" y="-352.6" font-family="Times,serif" font-size="8.00">27</text>
-- </g>
-- <!-- 3&#45;&gt;7 -->
-- <g id="edge23" class="edge">
-- <title>3&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M353.43,-368.18C358.79,-351.28 368.74,-323.13 381.56,-301 386.53,-292.43 401.67,-273.74 413.74,-259.29"/>
-- <polygon fill="black" stroke="black" points="416.64,-261.28 420.4,-251.38 411.28,-256.78 416.64,-261.28"/>
-- <text text-anchor="middle" x="389.56" y="-303.6" font-family="Times,serif" font-size="8.00">205</text>
-- </g>
-- <!-- 3&#45;&gt;3 -->
-- <g id="edge19" class="edge">
-- <title>3&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M341.24,-397.14C339.19,-406.92 341.44,-416.56 348.01,-416.56 352.21,-416.56 354.65,-412.6 355.32,-407.19"/>
-- <polygon fill="black" stroke="black" points="358.81,-406.93 354.77,-397.14 351.82,-407.31 358.81,-406.93"/>
-- <text text-anchor="middle" x="348.01" y="-419.16" font-family="Times,serif" font-size="8.00">211</text>
-- </g>
-- <!-- 3&#45;&gt;4 -->
-- <g id="edge20" class="edge">
-- <title>3&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M360.13,-393.32C366.15,-398.52 373.9,-404.63 381.56,-409 416.81,-429.11 461.7,-444.16 488.91,-452.26"/>
-- <polygon fill="black" stroke="black" points="488.17,-455.69 498.75,-455.11 490.12,-448.96 488.17,-455.69"/>
-- <text text-anchor="middle" x="431.12" y="-439.6" font-family="Times,serif" font-size="8.00">15</text>
-- </g>
-- <!-- 3&#45;&gt;5 -->
-- <g id="edge21" class="edge">
-- <title>3&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M332.52,-381.34C313.21,-379.56 278.15,-377.89 249.34,-385 232.94,-389.05 228.1,-390.93 215.34,-402 207.41,-408.88 200.47,-418.09 195.07,-426.54"/>
-- <polygon fill="black" stroke="black" points="191.98,-424.89 189.82,-435.26 197.98,-428.49 191.98,-424.89"/>
-- <text text-anchor="middle" x="264.89" y="-387.6" font-family="Times,serif" font-size="8.00">136</text>
-- </g>
-- <!-- 6 -->
-- <g id="node8" class="node">
-- <title>6</title>
-- <ellipse fill="none" stroke="black" cx="264.89" cy="-461" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="264.89" y="-459.1" font-family="Times,serif" font-size="8.00">6</text>
-- </g>
-- <!-- 3&#45;&gt;6 -->
-- <g id="edge22" class="edge">
-- <title>3&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M341.53,-397.54C336.23,-409.95 327.13,-427.54 314.45,-439 307.44,-445.33 298.3,-450.11 289.85,-453.57"/>
-- <polygon fill="black" stroke="black" points="288.59,-450.31 280.4,-457.04 291,-456.88 288.59,-450.31"/>
-- <text text-anchor="middle" x="306.45" y="-451.6" font-family="Times,serif" font-size="8.00">140</text>
-- </g>
-- <!-- 4&#45;&gt;0 -->
-- <g id="edge24" class="edge">
-- <title>4&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M512.17,-474.56C507.69,-533.68 488.03,-741 432.12,-741 97.67,-741 97.67,-741 97.67,-741 59.62,-741 31.57,-616.88 21.08,-562.27"/>
-- <polygon fill="black" stroke="black" points="24.5,-561.52 19.22,-552.33 17.62,-562.81 24.5,-561.52"/>
-- <text text-anchor="middle" x="264.89" y="-743.6" font-family="Times,serif" font-size="8.00">31</text>
-- </g>
-- <!-- 4&#45;&gt;2 -->
-- <g id="edge25" class="edge">
-- <title>4&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M527.02,-449.46C537.24,-440.93 552.18,-427.82 563.79,-415 570.21,-407.91 576.61,-399.6 582.02,-392.12"/>
-- <polygon fill="black" stroke="black" points="584.95,-394.03 587.85,-383.84 579.23,-390 584.95,-394.03"/>
-- <text text-anchor="middle" x="555.79" y="-432.6" font-family="Times,serif" font-size="8.00">9</text>
-- </g>
-- <!-- 4&#45;&gt;3 -->
-- <g id="edge26" class="edge">
-- <title>4&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M501.65,-449.34C488.89,-439.1 467.4,-423.05 446.68,-413 422.86,-401.46 393.64,-393.18 373.39,-388.28"/>
-- <polygon fill="black" stroke="black" points="373.96,-384.82 363.43,-385.97 372.38,-391.64 373.96,-384.82"/>
-- <text text-anchor="middle" x="431.12" y="-415.6" font-family="Times,serif" font-size="8.00">104</text>
-- </g>
-- <!-- 4&#45;&gt;4 -->
-- <g id="edge27" class="edge">
-- <title>4&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M507.46,-473.14C505.41,-482.92 507.67,-492.56 514.23,-492.56 518.44,-492.56 520.87,-488.6 521.54,-483.19"/>
-- <polygon fill="black" stroke="black" points="525.03,-482.93 521,-473.14 518.04,-483.31 525.03,-482.93"/>
-- <text text-anchor="middle" x="514.23" y="-495.16" font-family="Times,serif" font-size="8.00">104</text>
-- </g>
-- <!-- 4&#45;&gt;5 -->
-- <g id="edge28" class="edge">
-- <title>4&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M500.4,-466.8C494.58,-469.93 487.5,-473.22 480.68,-475 283.09,-526.68 305.72,-496.41 249.34,-486 233.43,-483.06 229.53,-480.76 215.34,-473 211.06,-470.66 206.71,-467.83 202.65,-464.94"/>
-- <polygon fill="black" stroke="black" points="204.42,-461.9 194.32,-458.7 200.22,-467.5 204.42,-461.9"/>
-- <text text-anchor="middle" x="348.01" y="-506.6" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 4&#45;&gt;6 -->
-- <g id="edge29" class="edge">
-- <title>4&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M498.65,-460.07C493.04,-460.43 486.56,-460.8 480.68,-461 406.84,-463.49 388.33,-461.78 314.45,-462 307.34,-462.02 305.56,-462.11 298.45,-462 295.88,-461.96 293.19,-461.9 290.51,-461.84"/>
-- <polygon fill="black" stroke="black" points="290.58,-458.34 280.48,-461.54 290.37,-465.33 290.58,-458.34"/>
-- <text text-anchor="middle" x="389.56" y="-464.6" font-family="Times,serif" font-size="8.00">149</text>
-- </g>
-- <!-- 5&#45;&gt;0 -->
-- <g id="edge30" class="edge">
-- <title>5&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M167.56,-456.09C139.39,-471.18 73.24,-506.62 38.6,-525.19"/>
-- <polygon fill="black" stroke="black" points="36.88,-522.14 29.72,-529.95 40.19,-528.31 36.88,-522.14"/>
-- <text text-anchor="middle" x="98.67" y="-502.6" font-family="Times,serif" font-size="8.00">114</text>
-- </g>
-- <!-- 5&#45;&gt;1 -->
-- <g id="edge31" class="edge">
-- <title>5&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M178.76,-433.59C175.09,-408.63 166.01,-358.2 148.23,-319 139.9,-300.66 126.7,-282.02 116.16,-268.6"/>
-- <polygon fill="black" stroke="black" points="118.69,-266.17 109.69,-260.58 113.24,-270.56 118.69,-266.17"/>
-- <text text-anchor="middle" x="140.23" y="-321.6" font-family="Times,serif" font-size="8.00">126</text>
-- </g>
-- <!-- 5&#45;&gt;2 -->
-- <g id="edge32" class="edge">
-- <title>5&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M187.89,-463.63C195.08,-483.9 208.13,-519.34 215.34,-531 227.26,-550.27 231.6,-554.9 249.34,-569 347.99,-647.44 418.4,-669.96 529.79,-611 553.54,-598.43 553.74,-585.92 563.79,-561 586.29,-505.21 593.25,-434.09 595.39,-396.68"/>
-- <polygon fill="black" stroke="black" points="598.89,-396.79 595.9,-386.63 591.9,-396.44 598.89,-396.79"/>
-- <text text-anchor="middle" x="389.56" y="-645.6" font-family="Times,serif" font-size="8.00">52</text>
-- </g>
-- <!-- 5&#45;&gt;7 -->
-- <g id="edge36" class="edge">
-- <title>5&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M183.11,-433.17C184.37,-406.03 190.1,-349.79 215.34,-311 240.62,-272.15 254.98,-264.1 298.45,-248 333.75,-234.93 377.99,-235.34 405.15,-237.32"/>
-- <polygon fill="black" stroke="black" points="405.07,-240.82 415.33,-238.19 405.67,-233.85 405.07,-240.82"/>
-- <text text-anchor="middle" x="306.45" y="-250.6" font-family="Times,serif" font-size="8.00">254</text>
-- </g>
-- <!-- 5&#45;&gt;3 -->
-- <g id="edge33" class="edge">
-- <title>5&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M196.5,-443.49C224.57,-432.21 288.82,-406.39 323.6,-392.41"/>
-- <polygon fill="black" stroke="black" points="325.01,-395.61 332.98,-388.64 322.39,-389.12 325.01,-395.61"/>
-- <text text-anchor="middle" x="264.89" y="-423.6" font-family="Times,serif" font-size="8.00">64</text>
-- </g>
-- <!-- 5&#45;&gt;4 -->
-- <g id="edge34" class="edge">
-- <title>5&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M190.39,-462.32C196.2,-471.46 204.97,-483.3 215.34,-491 246.32,-513.98 260.23,-510.83 298.45,-516 379.52,-526.97 410.38,-531.84 480.68,-490 486.18,-486.73 491.49,-482.37 496.18,-477.96"/>
-- <polygon fill="black" stroke="black" points="498.85,-480.24 503.39,-470.67 493.87,-475.31 498.85,-480.24"/>
-- <text text-anchor="middle" x="348.01" y="-525.6" font-family="Times,serif" font-size="8.00">16</text>
-- </g>
-- <!-- 5&#45;&gt;6 -->
-- <g id="edge35" class="edge">
-- <title>5&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M196.53,-454.08C202.27,-455.97 209.04,-457.92 215.34,-459 222.91,-460.3 231.24,-460.92 238.83,-461.19"/>
-- <polygon fill="black" stroke="black" points="238.85,-464.69 248.91,-461.37 238.98,-457.7 238.85,-464.69"/>
-- <text text-anchor="middle" x="223.34" y="-462.6" font-family="Times,serif" font-size="8.00">68</text>
-- </g>
-- <!-- 6&#45;&gt;0 -->
-- <g id="edge37" class="edge">
-- <title>6&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M250.17,-466.66C218.26,-479.62 136.34,-511.64 65.11,-529 57.35,-530.89 48.78,-532.47 41.03,-533.71"/>
-- <polygon fill="black" stroke="black" points="40.49,-530.25 31.12,-535.19 41.53,-537.17 40.49,-530.25"/>
-- <text text-anchor="middle" x="140.23" y="-511.6" font-family="Times,serif" font-size="8.00">76</text>
-- </g>
-- <!-- 6&#45;&gt;3 -->
-- <g id="edge38" class="edge">
-- <title>6&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M276.83,-450.48C290.21,-437.62 313.04,-415.66 329.02,-400.3"/>
-- <polygon fill="black" stroke="black" points="331.46,-402.81 336.24,-393.35 326.61,-397.76 331.46,-402.81"/>
-- <text text-anchor="middle" x="306.45" y="-430.6" font-family="Times,serif" font-size="8.00">31</text>
-- </g>
-- <!-- 6&#45;&gt;5 -->
-- <g id="edge39" class="edge">
-- <title>6&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M250.2,-455.33C244.47,-453.24 237.69,-451.11 231.34,-450 223.66,-448.66 215.2,-448.15 207.52,-448.06"/>
-- <polygon fill="black" stroke="black" points="207.31,-444.56 197.34,-448.15 207.37,-451.56 207.31,-444.56"/>
-- <text text-anchor="middle" x="223.34" y="-452.6" font-family="Times,serif" font-size="8.00">143</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
-- ## Empty Matrices
--
-- The `matrix` data type wraps a SuiteSparse GrB_Matrix handle and
-- delegates functions from SQL to the library through instances of
-- this type.
--
-- An empty matrix can be constructed many ways, but one of the
-- simplest is casting a type code to the matrix type.  In this case
-- `int32` means the SuiteSparse type `GrB_INT32`.
select 'int32'::matrix;
┌────────┐
│ matrix │
├────────┤
│ int32  │
└────────┘
(1 row)

-- Another way to create an empty matrix is to use the `matrix()`
-- constructor function:
select matrix('int32');
┌────────┐
│ matrix │
├────────┤
│ int32  │
└────────┘
(1 row)

-- ## Matrix dimensions
--
-- The above matrices are "unbounded", they do not have a fixed number
-- of rows and/or columns.  The default possible number of rows and
-- columns is defined by the SuiteSparse library to be `GrB_INDEX_MAX`
-- which is `2^60` power indexes.  For the purposes of this
-- documentation this will be referred to as `INDEX_MAX` and matrices
-- and vector dimensions that are `INDEX_MAX` in size are reffered to
-- as "unbounded".
--
-- For matrices with known dimensions, the dimensions can be provided
-- in parentesis after the type code.  Here a 4 row by 4 column
-- matrix is created:
select 'int32(4:4)'::matrix;
┌────────────┐
│   matrix   │
├────────────┤
│ int32(4:4) │
└────────────┘
(1 row)

-- Another way to make a new matrix is with the `matrix` constructor
-- function.
select matrix('int32', 4, 4);
┌────────────┐
│   matrix   │
├────────────┤
│ int32(4:4) │
└────────────┘
(1 row)

-- Either dimension can be ommited, this creates a 4 row by unbounded
-- column matrix.
select 'int32(4:)'::matrix;
┌───────────┐
│  matrix   │
├───────────┤
│ int32(4:) │
└───────────┘
(1 row)

-- This creates a unbounded row by 4 column matrix.
select 'int32(:4)'::matrix;
┌───────────┐
│  matrix   │
├───────────┤
│ int32(:4) │
└───────────┘
(1 row)

-- All graphblas operations are exposed by a series of functions and
-- operators.  Here we see three very common operations, returning the
-- number of rows, the number of columns, and the number of store
-- values.
select nrows('int32'::matrix),
       ncols('int32'::matrix),
       nvals('int32'::matrix);
┌─────────────────────┬─────────────────────┬───────┐
│        nrows        │        ncols        │ nvals │
├─────────────────────┼─────────────────────┼───────┤
│ 1152921504606846976 │ 1152921504606846976 │     0 │
└─────────────────────┴─────────────────────┴───────┘
(1 row)

-- Above you can see the matrix has unbounded rows and columns (the
-- very large number is the number of *possible* entries).  And the
-- number of stored values is zero.  These matrices are empty, they
-- contain no elements.
--
-- Values can be specified after the `type(dimension)` prefix as an
-- array of elements between square brackets.  Empty brackets imply no
-- elements, so empty square brackets are the same as no square
-- brackets as above:
select nrows('int32[]'::matrix),
       ncols('int32[]'::matrix),
       nvals('int32[]'::matrix);
┌─────────────────────┬─────────────────────┬───────┐
│        nrows        │        ncols        │ nvals │
├─────────────────────┼─────────────────────┼───────┤
│ 1152921504606846976 │ 1152921504606846976 │     0 │
└─────────────────────┴─────────────────────┴───────┘
(1 row)

-- Elements are specified between square brackets are coordinates of
-- 'row_id:column_id:value' separated by spaces:
select 'int32[1:2:1 2:3:2 3:1:3]'::matrix,
       'int32(4:)[1:2:1 2:3:2 3:1:3]'::matrix,
       'int32(:4)[1:2:1 2:3:2 3:3:1]'::matrix;
┌──────────────────────────┬──────────────────────────────┬──────────────────────────────┐
│          matrix          │            matrix            │            matrix            │
├──────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│ int32[1:2:1 2:3:2 3:1:3] │ int32(4:)[1:2:1 2:3:2 3:1:3] │ int32(:4)[1:2:1 2:3:2 3:3:1] │
└──────────────────────────┴──────────────────────────────┴──────────────────────────────┘
(1 row)

-- ## Elements
--
-- All the elements in a matrix can be iterated with the `elements()`
-- function:
select * from elements((select a from test_fixture));
┌───┬───┬──────────┐
│ i │ j │    v     │
├───┼───┼──────────┤
│ 0 │ 0 │ int8:36  │
│ 0 │ 1 │ int8:21  │
│ 1 │ 2 │ int8:40  │
│ 2 │ 1 │ int8:127 │
└───┴───┴──────────┘
(4 rows)

-- The inverse operation of constructing matrices from rows can be
-- done with `matrix_agg()`:
select matrix_agg(i, i, i) as unbound_matrix from generate_series(0, 10) as i;
┌─────────────────────────────────────────────────────────────────────────────┐
│                               unbound_matrix                                │
├─────────────────────────────────────────────────────────────────────────────┤
│ int32[0:0:0 1:1:1 2:2:2 3:3:3 4:4:4 5:5:5 6:6:6 7:7:7 8:8:8 9:9:9 10:10:10] │
└─────────────────────────────────────────────────────────────────────────────┘
(1 row)

-- Aggregate matrices are always unbounded so use `resize()` to bound
-- the matrix:
select print(resize(matrix_agg(i, i, i), 10, 10)) as bound_matrix from generate_series(0, 10) as i;
┌──────────────────────────────────────┐
│             bound_matrix             │
├──────────────────────────────────────┤
│      0  1  2  3  4  5  6  7  8  9   ↵│
│    ──────────────────────────────   ↵│
│  0│  0                              ↵│
│  1│     1                           ↵│
│  2│        2                        ↵│
│  3│           3                     ↵│
│  4│              4                  ↵│
│  5│                 5               ↵│
│  6│                    6            ↵│
│  7│                       7         ↵│
│  8│                          8      ↵│
│  9│                             9   ↵│
│                                      │
└──────────────────────────────────────┘
(1 row)

-- ## Equality
--
-- Two matrices can be compared for equality with the '=' and '!=' operators:
select a != b as "a != b", a = b as "a = b", b = a as "b = a", b = b as "b = b" from test_fixture;
┌────────┬───────┬───────┬───────┐
│ a != b │ a = b │ b = a │ b = b │
├────────┼───────┼───────┼───────┤
│ t      │ f     │ f     │ t     │
└────────┴───────┴───────┴───────┘
(1 row)

-- ## Setting and Getting individual Elements
-- Elements can be set individually with `set_element`, the modified
-- input is returned:
select print(set_element(a, 1, 1, 1)) as set_element from test_fixture;
┌────────────────────┐
│    set_element     │
├────────────────────┤
│      0  1  2  3   ↵│
│    ────────────   ↵│
│  0│ 36 21         ↵│
│  1│     1 40      ↵│
│  2│   127         ↵│
│  3│               ↵│
│                    │
└────────────────────┘
(1 row)

-- Scalar elements can be extracted individually with `get_element`
select get_element(a, 3, 2) as get_element from test_fixture;
┌─────────────┐
│ get_element │
├─────────────┤
│ int         │
└─────────────┘
(1 row)

-- If an element does exist `get_element` will return an "empty"
-- scalar:
select get_element(a, 3, 3) as get_element from test_fixture;
┌─────────────┐
│ get_element │
├─────────────┤
│ int         │
└─────────────┘
(1 row)

-- ## Elementwise Addition
--
-- The GraphBLAS API has elementwise operations on matrices that
-- operate pairs of matrices.  `eadd` computes the element-wise
-- “addition” of two matrices a and b, element-wise using any binary
-- operator.  The "add" in the name means that the union of both
-- graphs is taken; elements present on both sides of the operation
-- are included in the result.
select print(a) as a, binaryop, print(b) as b, print(eadd(a, b, binaryop)) as "eadd(a, b, binaryop)" from test_fixture;
┌────────────────────┬─────────────┬────────────────────┬──────────────────────┐
│         a          │  binaryop   │         b          │ eadd(a, b, binaryop) │
├────────────────────┼─────────────┼────────────────────┼──────────────────────┤
│      0  1  2  3   ↵│ times_int32 │      0  1  2  3   ↵│      0  1  2  3     ↵│
│    ────────────   ↵│             │    ────────────   ↵│    ────────────     ↵│
│  0│ 36 21         ↵│             │  0│    55         ↵│  0│ 36-12           ↵│
│  1│       40      ↵│             │  1│-67-71         ↵│  1│-67-71 40        ↵│
│  2│   127         ↵│             │  2│               ↵│  2│   127           ↵│
│  3│               ↵│             │  3│-77   -10      ↵│  3│-77   -10        ↵│
│                    │             │                    │                      │
└────────────────────┴─────────────┴────────────────────┴──────────────────────┘
(1 row)

-- Eadd can also be accomplished with binary operators specific to
-- OneSparse.  Different binaryops are passed to eadd to do different
-- elementwise operations:
select print(a |+ b) as "a |+ b", print(a |- b) as "a |- b", print(a |* b) as "a |* b", print(a |/ b) as "a |/ b" from test_fixture;
┌────────────────────┬────────────────────┬────────────────────┬────────────────────┐
│       a |+ b       │       a |- b       │       a |* b       │       a |/ b       │
├────────────────────┼────────────────────┼────────────────────┼────────────────────┤
│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│
│  0│ 36 76         ↵│  0│ 36-34         ↵│  0│ 36-12         ↵│  0│ 36  0         ↵│
│  1│-67-71 40      ↵│  1│-67-71 40      ↵│  1│-67-71 40      ↵│  1│-67-71 40      ↵│
│  2│   127         ↵│  2│   127         ↵│  2│   127         ↵│  2│   127         ↵│
│  3│-77   -10      ↵│  3│-77   -10      ↵│  3│-77   -10      ↵│  3│-77   -10      ↵│
│                    │                    │                    │                    │
└────────────────────┴────────────────────┴────────────────────┴────────────────────┘
(1 row)

-- From a graph standpoint, elementwise addition can be seen as the
-- merging ("union") of two graphs, such that the result has edges
-- from both graphs.  Any edges that occur in both graphs are merged
-- with the provided binary operator.
select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(eadd(a, b, binaryop)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="289pt" height="104pt"
--  viewBox="0.00 0.00 289.45 104.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 100.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-100.11 285.45,-100.11 285.45,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="96.67" cy="-43.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="96.67" y="-41.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M89.9,-57.69C87.85,-67.48 90.11,-77.11 96.67,-77.11 100.87,-77.11 103.31,-73.16 103.98,-67.74"/>
-- <polygon fill="black" stroke="black" points="107.47,-67.49 103.44,-57.69 100.48,-67.87 107.47,-67.49"/>
-- <text text-anchor="middle" x="96.67" y="-79.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-53.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-51.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M112.25,-45.37C117.87,-46.06 124.34,-46.85 130.23,-47.56 138.91,-48.59 148.41,-49.71 156.87,-50.69"/>
-- <polygon fill="black" stroke="black" points="156.55,-54.18 166.89,-51.85 157.36,-47.22 156.55,-54.18"/>
-- <text text-anchor="middle" x="139.73" y="-52.16" font-family="Times,serif" font-size="8.00">&#45;125</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.93,-46.07C163.12,-43.11 156.03,-40.05 149.23,-38.56 140.36,-36.61 130.47,-36.98 121.74,-38.14"/>
-- <polygon fill="black" stroke="black" points="121.08,-34.7 111.81,-39.84 122.26,-41.6 121.08,-34.7"/>
-- <text text-anchor="middle" x="139.73" y="-41.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-67.69C173.96,-77.48 176.22,-87.11 182.78,-87.11 186.99,-87.11 189.42,-83.16 190.09,-77.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-77.49 189.55,-67.69 186.59,-77.87 193.58,-77.49"/>
-- <text text-anchor="middle" x="182.78" y="-89.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="265.89" cy="-32.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="265.89" y="-30.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M198.3,-50.57C207.99,-48.5 220.98,-45.58 232.34,-42.56 235.18,-41.8 238.14,-40.96 241.07,-40.1"/>
-- <polygon fill="black" stroke="black" points="242.15,-43.43 250.7,-37.17 240.11,-36.73 242.15,-43.43"/>
-- <text text-anchor="middle" x="224.34" y="-48.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge6" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M250.14,-30.88C240.36,-30.24 227.34,-30.32 216.34,-33.56 212.11,-34.8 207.89,-36.74 203.95,-38.94"/>
-- <polygon fill="black" stroke="black" points="202.01,-36.02 195.42,-44.31 205.74,-41.94 202.01,-36.02"/>
-- <text text-anchor="middle" x="224.34" y="-36.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- <!-- 3 -->
-- <g id="node4" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge7" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.34,-20.43C41.84,-24.5 58.49,-30.4 72.1,-35.21"/>
-- <polygon fill="black" stroke="black" points="71.19,-38.6 81.78,-38.64 73.52,-32.01 71.19,-38.6"/>
-- <text text-anchor="middle" x="56.11" y="-34.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge8" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M31.26,-15.79C66.22,-16.46 157.04,-18.97 232.34,-27.56 234.92,-27.85 237.62,-28.2 240.3,-28.57"/>
-- <polygon fill="black" stroke="black" points="239.93,-32.06 250.34,-30.07 240.97,-25.13 239.93,-32.06"/>
-- <text text-anchor="middle" x="139.73" y="-23.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Elementwise Multiplication
--
-- `emult` multiplies elements of two matrices, taking only the
-- intersection of common elements in both matrices, if an element is
-- missing from either the left or right side, it is ommited from the
-- result:
select print(a) as a, binaryop, print(b) as b, print(emult(a, b, binaryop)) as "emult(a, b, binaryop)" from test_fixture;
┌────────────────────┬─────────────┬────────────────────┬───────────────────────┐
│         a          │  binaryop   │         b          │ emult(a, b, binaryop) │
├────────────────────┼─────────────┼────────────────────┼───────────────────────┤
│      0  1  2  3   ↵│ times_int32 │      0  1  2  3   ↵│      0  1  2  3      ↵│
│    ────────────   ↵│             │    ────────────   ↵│    ────────────      ↵│
│  0│ 36 21         ↵│             │  0│    55         ↵│  0│   -12            ↵│
│  1│       40      ↵│             │  1│-67-71         ↵│  1│                  ↵│
│  2│   127         ↵│             │  2│               ↵│  2│                  ↵│
│  3│               ↵│             │  3│-77   -10      ↵│  3│                  ↵│
│                    │             │                    │                       │
└────────────────────┴─────────────┴────────────────────┴───────────────────────┘
(1 row)

-- Emult can also be accomplished with binary operators specific to
-- OneSparse.  Different binaryops are passed to emult to do different
-- elementwise operations:
select print(a &+ b) as "a &+ b", print(a &- b) as "a &- b", print(a &* b) as "a &* b", print(a &/ b) as "a &/ b" from test_fixture;
┌────────────────────┬────────────────────┬────────────────────┬────────────────────┐
│       a &+ b       │       a &- b       │       a &* b       │       a &/ b       │
├────────────────────┼────────────────────┼────────────────────┼────────────────────┤
│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│
│  0│    76         ↵│  0│   -34         ↵│  0│   -12         ↵│  0│     0         ↵│
│  1│               ↵│  1│               ↵│  1│               ↵│  1│               ↵│
│  2│               ↵│  2│               ↵│  2│               ↵│  2│               ↵│
│  3│               ↵│  3│               ↵│  3│               ↵│  3│               ↵│
│                    │                    │                    │                    │
└────────────────────┴────────────────────┴────────────────────┴────────────────────┘
(1 row)

-- From a graph standpoint, elementwise multiplication can be seen as
-- the intersection of two graphs, such that the result has edges that
-- are only present in both graphs.  The edges are combined with the
-- provided binary operator.
select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(emult(a, b, binaryop)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="125pt" height="39pt"
--  viewBox="0.00 0.00 125.23 39.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 35.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-35.11 121.23,-35.11 121.23,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.21,-15.56C43.44,-15.56 61.14,-15.56 75.61,-15.56"/>
-- <polygon fill="black" stroke="black" points="75.9,-19.06 85.9,-15.56 75.9,-12.06 75.9,-19.06"/>
-- <text text-anchor="middle" x="58.61" y="-18.16" font-family="Times,serif" font-size="8.00">&#45;125</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Elementwise Union
--
-- `eunion` is like `eadd` but differs in how the binary op is
-- applied. A pair of scalars, `alpha` and `beta` define the inputs to
-- the operator when entries are present in one matrix but not the
-- other.
select print(a) as a, binaryop, print(b) as b, print(eunion(a, 3::scalar, b, 4::scalar, binaryop)) as "eunion(a, 3::scalar, b, 4::scalar, binaryop)" from test_fixture;
┌────────────────────┬─────────────┬────────────────────┬──────────────────────────────────────────────┐
│         a          │  binaryop   │         b          │ eunion(a, 3::scalar, b, 4::scalar, binaryop) │
├────────────────────┼─────────────┼────────────────────┼──────────────────────────────────────────────┤
│      0  1  2  3   ↵│ times_int32 │      0  1  2  3   ↵│      0  1  2  3                             ↵│
│    ────────────   ↵│             │    ────────────   ↵│    ────────────                             ↵│
│  0│ 36 21         ↵│             │  0│    55         ↵│  0│-11-12                                   ↵│
│  1│       40      ↵│             │  1│-67-71         ↵│  1│ 55 43-96                                ↵│
│  2│   127         ↵│             │  2│               ↵│  2│    -4                                   ↵│
│  3│               ↵│             │  3│-77   -10      ↵│  3│ 25   -71                                ↵│
│                    │             │                    │                                              │
└────────────────────┴─────────────┴────────────────────┴──────────────────────────────────────────────┘
(1 row)

-- From a graph standpoint, elementwise union is very similar to
-- `eadd()`, and can be seen as the merging ("union") of two graphs,
-- such that the result has edges from both graphs.  Any edges that
-- occur in both graphs are merged with the provided binary operator.
-- If an edge occurs in a but not in b, it is combined with the
-- scalar `alpha`, if the edge occurs in the b but not in a, then
-- the edge is combined with scalar `beta`.
select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(eunion(a, 3::scalar, b, 4::scalar, binaryop)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="284pt" height="104pt"
--  viewBox="0.00 0.00 284.45 104.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 100.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-100.11 280.45,-100.11 280.45,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-43.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-41.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M87.17,-58.04C85.34,-67.71 87.51,-77.11 93.67,-77.11 97.52,-77.11 99.81,-73.44 100.54,-68.32"/>
-- <polygon fill="black" stroke="black" points="104.03,-67.91 100.17,-58.04 97.03,-68.16 104.03,-67.91"/>
-- <text text-anchor="middle" x="93.67" y="-79.71" font-family="Times,serif" font-size="8.00">&#45;112</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="179.78" cy="-53.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="179.78" y="-51.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M109.25,-45.37C114.87,-46.06 121.34,-46.85 127.23,-47.56 135.91,-48.59 145.41,-49.71 153.87,-50.69"/>
-- <polygon fill="black" stroke="black" points="153.55,-54.18 163.89,-51.85 154.36,-47.22 153.55,-54.18"/>
-- <text text-anchor="middle" x="136.73" y="-52.16" font-family="Times,serif" font-size="8.00">&#45;125</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M165.93,-46.07C160.12,-43.11 153.03,-40.05 146.23,-38.56 137.36,-36.61 127.47,-36.98 118.74,-38.14"/>
-- <polygon fill="black" stroke="black" points="118.08,-34.7 108.81,-39.84 119.26,-41.6 118.08,-34.7"/>
-- <text text-anchor="middle" x="136.73" y="-41.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M173.01,-67.69C170.96,-77.48 173.22,-87.11 179.78,-87.11 183.99,-87.11 186.42,-83.16 187.09,-77.74"/>
-- <polygon fill="black" stroke="black" points="190.58,-77.49 186.55,-67.69 183.59,-77.87 190.58,-77.49"/>
-- <text text-anchor="middle" x="179.78" y="-89.71" font-family="Times,serif" font-size="8.00">43</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="260.89" cy="-32.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="260.89" y="-30.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M195.11,-50.43C204.35,-48.35 216.6,-45.47 227.34,-42.56 230.17,-41.79 233.13,-40.94 236.07,-40.07"/>
-- <polygon fill="black" stroke="black" points="237.14,-43.4 245.69,-37.14 235.1,-36.71 237.14,-43.4"/>
-- <text text-anchor="middle" x="220.34" y="-48.16" font-family="Times,serif" font-size="8.00">&#45;96</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge6" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M245.33,-30.94C236,-30.37 223.73,-30.5 213.34,-33.56 209.11,-34.8 204.89,-36.74 200.95,-38.94"/>
-- <polygon fill="black" stroke="black" points="199.02,-36.02 192.42,-44.31 202.74,-41.95 199.02,-36.02"/>
-- <text text-anchor="middle" x="220.34" y="-36.16" font-family="Times,serif" font-size="8.00">&#45;4</text>
-- </g>
-- <!-- 3 -->
-- <g id="node4" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge7" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.52,-20.69C41.35,-24.68 56.62,-30.29 69.31,-34.96"/>
-- <polygon fill="black" stroke="black" points="68.2,-38.29 78.8,-38.45 70.62,-31.72 68.2,-38.29"/>
-- <text text-anchor="middle" x="54.61" y="-34.16" font-family="Times,serif" font-size="8.00">25</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge8" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M31.17,-15.81C65.51,-16.54 153.96,-19.14 227.34,-27.56 229.92,-27.85 232.62,-28.2 235.3,-28.58"/>
-- <polygon fill="black" stroke="black" points="234.93,-32.06 245.34,-30.08 235.97,-25.14 234.93,-32.06"/>
-- <text text-anchor="middle" x="136.73" y="-23.16" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Reduction
--
-- The entire matrix can be reduced to a scalar value:
select print(b) as b, 'plus_monoid_int32' as monoid, reduce_scalar(b) from test_fixture;
┌────────────────────┬───────────────────┬───────────────┐
│         b          │      monoid       │ reduce_scalar │
├────────────────────┼───────────────────┼───────────────┤
│      0  1  2  3   ↵│ plus_monoid_int32 │ int8:-13      │
│    ────────────   ↵│                   │               │
│  0│    55         ↵│                   │               │
│  1│-67-71         ↵│                   │               │
│  2│               ↵│                   │               │
│  3│-77   -10      ↵│                   │               │
│                    │                   │               │
└────────────────────┴───────────────────┴───────────────┘
(1 row)

-- The entire matrix can be reduced to a scalar value with a provided
-- monoid that changes the reduction operation:
select print(b) as b, 'min_monoid_int32' as monoid, reduce_scalar(b, 'min_monoid_int32') from test_fixture;
┌────────────────────┬──────────────────┬───────────────┐
│         b          │      monoid      │ reduce_scalar │
├────────────────────┼──────────────────┼───────────────┤
│      0  1  2  3   ↵│ min_monoid_int32 │ int8:-109     │
│    ────────────   ↵│                  │               │
│  0│    55         ↵│                  │               │
│  1│-67-71         ↵│                  │               │
│  2│               ↵│                  │               │
│  3│-77   -10      ↵│                  │               │
│                    │                  │               │
└────────────────────┴──────────────────┴───────────────┘
(1 row)

-- The matrix can also be reduced to a column vector:
select print(b) as b, 'plus_monoid_int32' as monoid, print(reduce_cols(b)) as reduce_cols from test_fixture;
┌────────────────────┬───────────────────┬─────────────┐
│         b          │      monoid       │ reduce_cols │
├────────────────────┼───────────────────┼─────────────┤
│      0  1  2  3   ↵│ plus_monoid_int32 │            ↵│
│    ────────────   ↵│                   │    ───     ↵│
│  0│    55         ↵│                   │  0│ 55     ↵│
│  1│-67-71         ↵│                   │  1│118     ↵│
│  2│               ↵│                   │  2│        ↵│
│  3│-77   -10      ↵│                   │  3│ 70     ↵│
│                    │                   │             │
└────────────────────┴───────────────────┴─────────────┘
(1 row)

-- To reduce a row vector:
select print(b) as b, 'plus_monoid_int32' as monoid, print(reduce_rows(b)) as reduce_rows from test_fixture;
┌────────────────────┬───────────────────┬─────────────┐
│         b          │      monoid       │ reduce_rows │
├────────────────────┼───────────────────┼─────────────┤
│      0  1  2  3   ↵│ plus_monoid_int32 │            ↵│
│    ────────────   ↵│                   │    ───     ↵│
│  0│    55         ↵│                   │  0│112     ↵│
│  1│-67-71         ↵│                   │  1│-16     ↵│
│  2│               ↵│                   │  2│-10     ↵│
│  3│-77   -10      ↵│                   │  3│        ↵│
│                    │                   │             │
└────────────────────┴───────────────────┴─────────────┘
(1 row)

-- ## Matrix Matrix Multiplication
--
-- Matrix Multiplication is the heart of linear algebra.  All matrix
-- multiplication happens over a semiring.  For the most common form
-- of matrix multiplication, the outer opperation is to multiply
-- coresponding elements with the "times" operator and then reduce
-- those products with the "plus" operator.  This is called the
-- `plus_times` semiring:
select print(a) as a, semiring, print(b) as b, print(mxm(a, b)) as "mxm(a, b)" from test_fixture;
┌────────────────────┬──────────────────┬────────────────────┬────────────────────┐
│         a          │     semiring     │         b          │     mxm(a, b)      │
├────────────────────┼──────────────────┼────────────────────┼────────────────────┤
│      0  1  2  3   ↵│ plus_times_int32 │      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│                  │    ────────────   ↵│    ────────────   ↵│
│  0│ 36 21         ↵│                  │  0│    55         ↵│  0│-12-23         ↵│
│  1│       40      ↵│                  │  1│-67-71         ↵│  1│               ↵│
│  2│   127         ↵│                  │  2│               ↵│  2│-61-57         ↵│
│  3│               ↵│                  │  3│-77   -10      ↵│  3│               ↵│
│                    │                  │                    │                    │
└────────────────────┴──────────────────┴────────────────────┴────────────────────┘
(1 row)

select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(mxm(a, b)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="201pt" height="93pt"
--  viewBox="0.00 0.00 201.34 93.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 89.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-89.11 197.34,-89.11 197.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="96.67" cy="-42.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="96.67" y="-40.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M89.9,-56.69C87.85,-66.48 90.11,-76.11 96.67,-76.11 100.87,-76.11 103.31,-72.16 103.98,-66.74"/>
-- <polygon fill="black" stroke="black" points="107.47,-66.49 103.44,-56.69 100.48,-66.87 107.47,-66.49"/>
-- <text text-anchor="middle" x="96.67" y="-78.71" font-family="Times,serif" font-size="8.00">&#45;127</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="177.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="177.78" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M111.81,-37.73C123.29,-33.81 139.71,-28.21 153.17,-23.61"/>
-- <polygon fill="black" stroke="black" points="154.43,-26.88 162.76,-20.34 152.17,-20.26 154.43,-26.88"/>
-- <text text-anchor="middle" x="137.23" y="-33.16" font-family="Times,serif" font-size="8.00">&#45;23</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 2&#45;&gt;0 -->
-- <g id="edge3" class="edge">
-- <title>2&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.7,-20.38C42.18,-24.3 58.6,-29.9 72.06,-34.5"/>
-- <polygon fill="black" stroke="black" points="71.05,-37.85 81.65,-37.77 73.31,-31.23 71.05,-37.85"/>
-- <text text-anchor="middle" x="56.11" y="-33.16" font-family="Times,serif" font-size="8.00">&#45;61</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.13,-13.52C44.19,-11.81 63.89,-9.49 81.11,-8.56 94.92,-7.81 98.42,-7.81 112.23,-8.56 125.41,-9.27 140.05,-10.8 152.04,-12.24"/>
-- <polygon fill="black" stroke="black" points="151.85,-15.74 162.2,-13.52 152.72,-8.8 151.85,-15.74"/>
-- <text text-anchor="middle" x="96.67" y="-11.16" font-family="Times,serif" font-size="8.00">&#45;57</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- AxB can also be done with the `@` operator, mimicking the Python
-- syntax.  The default semiring for numeric types is `plus_times`.
select print(a) as a, '@' as "@", print(b) as b, print(a @ b) as "a @ b" from test_fixture;
┌────────────────────┬───┬────────────────────┬────────────────────┐
│         a          │ @ │         b          │       a @ b        │
├────────────────────┼───┼────────────────────┼────────────────────┤
│      0  1  2  3   ↵│ @ │      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│   │    ────────────   ↵│    ────────────   ↵│
│  0│ 36 21         ↵│   │  0│    55         ↵│  0│-12-23         ↵│
│  1│       40      ↵│   │  1│-67-71         ↵│  1│               ↵│
│  2│   127         ↵│   │  2│               ↵│  2│-61-57         ↵│
│  3│               ↵│   │  3│-77   -10      ↵│  3│               ↵│
│                    │   │                    │                    │
└────────────────────┴───┴────────────────────┴────────────────────┘
(1 row)

-- ## Matrix Vector Multiplication
--
-- Matrices can be multipled by vectors on the right taking the linear
-- combination of the matrices columns using the vectors elements as
-- coefficients:
select print(a) as a, '@' as "@", semiring, print(u) as u, print(mxv(a, u)) as "mxv(a, u)" from test_fixture;
┌────────────────────┬───┬──────────────────┬───────────┬───────────┐
│         a          │ @ │     semiring     │     u     │ mxv(a, u) │
├────────────────────┼───┼──────────────────┼───────────┼───────────┤
│      0  1  2  3   ↵│ @ │ plus_times_int32 │          ↵│          ↵│
│    ────────────   ↵│   │                  │    ───   ↵│    ───   ↵│
│  0│ 36 21         ↵│   │                  │  0│      ↵│  0│ 42   ↵│
│  1│       40      ↵│   │                  │  1│  2   ↵│  1│      ↵│
│  2│   127         ↵│   │                  │  2│      ↵│  2│254   ↵│
│  3│               ↵│   │                  │  3│      ↵│  3│      ↵│
│                    │   │                  │           │           │
└────────────────────┴───┴──────────────────┴───────────┴───────────┘
(1 row)

-- From a graph standpoint, matrix vector multiplication is used to
-- "pull" back to adjacent nodes from their incoming edges.  When
-- iterated, it forms the basis for working back along incoming links.
select draw(a) as binop_a_source, draw(u) as binop_b_source, draw(mxv(a, u)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="70pt" height="177pt"
--  viewBox="0.00 0.00 70.00 177.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 173)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-173 66,-173 66,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-161 54,-161 54,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="33,-153 29,-153 29,-149 33,-149 33,-153"/>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="46,-113 16,-113 16,-96 46,-96 46,-113"/>
-- <text text-anchor="middle" x="31" y="-102.6" font-family="Times,serif" font-size="8.00">1:2</text>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="33,-60 29,-60 29,-56 33,-56 33,-60"/>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="33,-20 29,-20 29,-16 33,-16 33,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="82pt" height="190pt"
--  viewBox="0.00 0.00 82.00 190.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 186)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-186 78,-186 78,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-174 66,-174 66,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="54.5,-166 19.5,-166 19.5,-149 54.5,-149 54.5,-166"/>
-- <text text-anchor="middle" x="37" y="-155.6" font-family="Times,serif" font-size="8.00">0:42</text>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="39,-113 35,-113 35,-109 39,-109 39,-113"/>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="57.5,-73 16.5,-73 16.5,-56 57.5,-56 57.5,-73"/>
-- <text text-anchor="middle" x="37" y="-62.6" font-family="Times,serif" font-size="8.00">2:254</text>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="39,-20 35,-20 35,-16 39,-16 39,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- 'mxv' is also supported by the `@` operator:
select print(a) as a, '@' as "@", print(u) as u, print(a @ u) as "a @ u" from test_fixture;
┌────────────────────┬───┬───────────┬───────────┐
│         a          │ @ │     u     │   a @ u   │
├────────────────────┼───┼───────────┼───────────┤
│      0  1  2  3   ↵│ @ │          ↵│          ↵│
│    ────────────   ↵│   │    ───   ↵│    ───   ↵│
│  0│ 36 21         ↵│   │  0│      ↵│  0│ 42   ↵│
│  1│       40      ↵│   │  1│  2   ↵│  1│      ↵│
│  2│   127         ↵│   │  2│      ↵│  2│254   ↵│
│  3│               ↵│   │  3│      ↵│  3│      ↵│
│                    │   │           │           │
└────────────────────┴───┴───────────┴───────────┘
(1 row)

-- ## Vector Matrix Multiplication
--
-- Matrices can be multipled by vectors on the right taking the linear
-- combination of the matrices rows using the vectors elements as
-- coefficients:
select print(v) as v, semiring, print(b) as b, print(vxm(v, b, semiring)) as "vxm(v, b, semiring)" from test_fixture;
┌───────────┬──────────────────┬────────────────────┬─────────────────────┐
│     v     │     semiring     │         b          │ vxm(v, b, semiring) │
├───────────┼──────────────────┼────────────────────┼─────────────────────┤
│          ↵│ plus_times_int32 │      0  1  2  3   ↵│                    ↵│
│    ───   ↵│                  │    ────────────   ↵│    ───             ↵│
│  0│      ↵│                  │  0│    55         ↵│  0│-20             ↵│
│  1│  3   ↵│                  │  1│-67-71         ↵│  1│-21             ↵│
│  2│  3   ↵│                  │  2│               ↵│  2│                ↵│
│  3│      ↵│                  │  3│-77   -10      ↵│  3│                ↵│
│           │                  │                    │                     │
└───────────┴──────────────────┴────────────────────┴─────────────────────┘
(1 row)

-- From a graph standpoint, vector matrix multiplication is used to
-- "push" forward to adjacent nodes from their outgoing edges.  When
-- iterated, it forms the basis for working forward along outgoing
-- edges.
select draw(v) as binop_a_source, draw(b) as binop_b_source, draw(vxm(v, b)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="70pt" height="190pt"
--  viewBox="0.00 0.00 70.00 190.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 186)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-186 66,-186 66,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-174 54,-174 54,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="33,-166 29,-166 29,-162 33,-162 33,-166"/>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="46,-126 16,-126 16,-109 46,-109 46,-126"/>
-- <text text-anchor="middle" x="31" y="-115.6" font-family="Times,serif" font-size="8.00">1:3</text>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="46,-73 16,-73 16,-56 46,-56 46,-73"/>
-- <text text-anchor="middle" x="31" y="-62.6" font-family="Times,serif" font-size="8.00">2:3</text>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="33,-20 29,-20 29,-16 33,-16 33,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="206pt" height="115pt"
--  viewBox="0.00 0.00 206.34 115.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 111.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-111.11 202.34,-111.11 202.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-62.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="182.78" cy="-64.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="182.78" y="-62.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M117.55,-64.56C128.6,-64.56 143.93,-64.56 156.84,-64.56"/>
-- <polygon fill="black" stroke="black" points="156.97,-68.06 166.97,-64.56 156.97,-61.06 156.97,-68.06"/>
-- <text text-anchor="middle" x="142.23" y="-67.16" font-family="Times,serif" font-size="8.00">55</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge2" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M168.47,-57.42C159.24,-53.32 146.6,-49.37 135.23,-51.56 131.94,-52.19 128.56,-53.15 125.28,-54.27"/>
-- <polygon fill="black" stroke="black" points="123.98,-51.02 115.94,-57.93 126.53,-57.54 123.98,-51.02"/>
-- <text text-anchor="middle" x="142.23" y="-54.16" font-family="Times,serif" font-size="8.00">&#45;67</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M176.01,-78.69C173.96,-88.48 176.22,-98.11 182.78,-98.11 186.99,-98.11 189.42,-94.16 190.09,-88.74"/>
-- <polygon fill="black" stroke="black" points="193.58,-88.49 189.55,-78.69 186.59,-88.87 193.58,-88.49"/>
-- <text text-anchor="middle" x="182.78" y="-100.71" font-family="Times,serif" font-size="8.00">&#45;71</text>
-- </g>
-- <!-- 3 -->
-- <g id="node3" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-31.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-29.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge4" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M30.45,-37.01C43.18,-42 62.3,-49.5 77.38,-55.42"/>
-- <polygon fill="black" stroke="black" points="76.45,-58.81 87.04,-59.21 79.01,-52.3 76.45,-58.81"/>
-- <text text-anchor="middle" x="58.61" y="-53.16" font-family="Times,serif" font-size="8.00">&#45;77</text>
-- </g>
-- <!-- 2 -->
-- <g id="node4" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="101.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="101.67" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M30.79,-28.37C36.48,-27.13 43.1,-25.73 49.11,-24.56 57.89,-22.85 67.54,-21.12 76.1,-19.64"/>
-- <polygon fill="black" stroke="black" points="76.92,-23.05 86.2,-17.93 75.75,-16.15 76.92,-23.05"/>
-- <text text-anchor="middle" x="58.61" y="-27.16" font-family="Times,serif" font-size="8.00">&#45;109</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: vector Pages: 1 -->
-- <svg width="84pt" height="190pt"
--  viewBox="0.00 0.00 84.00 190.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 186)">
-- <title>vector</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-186 80,-186 80,4 -4,4"/>
-- <g id="clust1" class="cluster">
-- <title>cluster_vector</title>
-- <polygon fill="lightgray" stroke="black" stroke-dasharray="5,2" points="8,-8 8,-174 68,-174 68,-8 8,-8"/>
-- </g>
-- <!-- node0 -->
-- <g id="node1" class="node">
-- <title>node0</title>
-- <polygon fill="none" stroke="black" points="60,-166 16,-166 16,-149 60,-149 60,-166"/>
-- <text text-anchor="middle" x="38" y="-155.6" font-family="Times,serif" font-size="8.00">0:&#45;201</text>
-- </g>
-- <!-- node1 -->
-- <g id="node2" class="node">
-- <title>node1</title>
-- <polygon fill="none" stroke="black" points="60,-113 16,-113 16,-96 60,-96 60,-113"/>
-- <text text-anchor="middle" x="38" y="-102.6" font-family="Times,serif" font-size="8.00">1:&#45;213</text>
-- </g>
-- <!-- node0&#45;&gt;node1 -->
-- <!-- node2 -->
-- <g id="node3" class="node">
-- <title>node2</title>
-- <polygon fill="none" stroke="black" points="40,-60 36,-60 36,-56 40,-56 40,-60"/>
-- </g>
-- <!-- node1&#45;&gt;node2 -->
-- <!-- node3 -->
-- <g id="node4" class="node">
-- <title>node3</title>
-- <polygon fill="none" stroke="black" points="40,-20 36,-20 36,-16 40,-16 40,-20"/>
-- </g>
-- <!-- node2&#45;&gt;node3 -->
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- 'vxm' is also supported by the `@` operator:
select print(v) as v, '@' as "@", print(b) as b, print(v @ b) as "v @ b" from test_fixture;
┌───────────┬───┬────────────────────┬───────────┐
│     v     │ @ │         b          │   v @ b   │
├───────────┼───┼────────────────────┼───────────┤
│          ↵│ @ │      0  1  2  3   ↵│          ↵│
│    ───   ↵│   │    ────────────   ↵│    ───   ↵│
│  0│      ↵│   │  0│    55         ↵│  0│-20   ↵│
│  1│  3   ↵│   │  1│-67-71         ↵│  1│-21   ↵│
│  2│  3   ↵│   │  2│               ↵│  2│      ↵│
│  3│      ↵│   │  3│-77   -10      ↵│  3│      ↵│
│           │   │                    │           │
└───────────┴───┴────────────────────┴───────────┘
(1 row)

-- ## Choosing Elements
--
-- The `choose` method calls the `GrB_select()` API function.  The
-- name `choose` was chosen not to conflict with the SQL keyword
-- `select`.  Selection provides a conditional operator called an
-- `indexunaryop` and a parameter for the operator to use to compare
-- elements in the matrix.  Below, all elements with values greater
-- than 1 are returned:
select print(a) as a, indexunaryop, print(choose(a, indexunaryop, 1)) as selected from test_fixture;
┌────────────────────┬───────────────┬────────────────────┐
│         a          │ indexunaryop  │      selected      │
├────────────────────┼───────────────┼────────────────────┤
│      0  1  2  3   ↵│ valuegt_int32 │      0  1  2  3   ↵│
│    ────────────   ↵│               │    ────────────   ↵│
│  0│ 36 21         ↵│               │  0│ 36 21         ↵│
│  1│       40      ↵│               │  1│       40      ↵│
│  2│   127         ↵│               │  2│   127         ↵│
│  3│               ↵│               │  3│               ↵│
│                    │               │                    │
└────────────────────┴───────────────┴────────────────────┘
(1 row)

select draw(a) as uop_a_source, draw(choose(a, indexunaryop, 1)) as uop_b_source from test_fixture \gset
\i sql/uop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 45%;">
--         <!-- Diagram A -->
\set draw_source :uop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 45%;">
--         <!-- Diagram B -->
\set draw_source :uop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="200pt" height="66pt"
--  viewBox="0.00 0.00 200.34 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 196.34,-62.11 196.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.06,-30.04C7.23,-39.71 9.4,-49.11 15.56,-49.11 19.41,-49.11 21.7,-45.44 22.43,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.91,-39.91 22.05,-30.04 18.92,-40.16 25.91,-39.91"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">36</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="93.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="93.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.23,-15.56C41.55,-15.56 55.61,-15.56 67.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="68.04,-19.06 78.04,-15.56 68.04,-12.06 68.04,-19.06"/>
-- <text text-anchor="middle" x="54.61" y="-18.16" font-family="Times,serif" font-size="8.00">21</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-13.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.55,-15.56C121.09,-15.56 137.36,-15.56 150.88,-15.56"/>
-- <polygon fill="black" stroke="black" points="151,-19.06 161,-15.56 151,-12.06 151,-19.06"/>
-- <text text-anchor="middle" x="135.23" y="-18.16" font-family="Times,serif" font-size="8.00">40</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge4" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M162.51,-8.93C156.74,-6.4 149.8,-3.82 143.23,-2.56 136.24,-1.21 134.21,-1.21 127.23,-2.56 123.94,-3.19 120.56,-4.15 117.28,-5.27"/>
-- <polygon fill="black" stroke="black" points="115.98,-2.02 107.94,-8.93 118.53,-8.54 115.98,-2.02"/>
-- <text text-anchor="middle" x="135.23" y="-5.16" font-family="Times,serif" font-size="8.00">127</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Choosing Operators
-- Selection can also be done with scalars and operators:p
select print(a > 1) as "a > 1", print(a >= 1) as "a >= 1", print(a < 1) as "a < 1", print(a <= 1) as "a <= 1" from test_fixture;
┌────────────────────┬────────────────────┬────────────────────┬────────────────────┐
│       a > 1        │       a >= 1       │       a < 1        │       a <= 1       │
├────────────────────┼────────────────────┼────────────────────┼────────────────────┤
│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│      0  1  2  3   ↵│
│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│    ────────────   ↵│
│  0│ 36 21         ↵│  0│ 36 21         ↵│  0│               ↵│  0│               ↵│
│  1│       40      ↵│  1│       40      ↵│  1│               ↵│  1│               ↵│
│  2│   127         ↵│  2│   127         ↵│  2│               ↵│  2│               ↵│
│  3│               ↵│  3│               ↵│  3│               ↵│  3│               ↵│
│                    │                    │                    │                    │
└────────────────────┴────────────────────┴────────────────────┴────────────────────┘
(1 row)

-- A useful select operator is `triu`, it select only upper triangular
-- values, this turns your graph into a direct acyclic graph (DAG) by
-- removing all the links "back" from higher number nodes to lower.
select print(random_matrix('uint8', 8, 8, 1, 42)) as matrix,
       print(choose(random_matrix('uint8', 8, 8, 1, 42), 'triu', 0)) as triu from test_fixture;
┌────────────────────────────────┬────────────────────────────────┐
│             matrix             │              triu              │
├────────────────────────────────┼────────────────────────────────┤
│      0  1  2  3  4  5  6  7   ↵│      0  1  2  3  4  5  6  7   ↵│
│    ────────────────────────   ↵│    ────────────────────────   ↵│
│  0│ 65251126            179   ↵│  0│ 65251126            179   ↵│
│  1│190    67233 85 24   107   ↵│  1│       67233 85 24   107   ↵│
│  2│    84 62213123  5         ↵│  2│       62213123  5         ↵│
│  3│ 56108 27211 15136140205   ↵│  3│         211 15136140205   ↵│
│  4│ 31     9104104107149      ↵│  4│            104107149      ↵│
│  5│114126 52 64 16    68254   ↵│  5│                   68254   ↵│
│  6│ 76       31   143         ↵│  6│                           ↵│
│  7│   226231    68 35   160   ↵│  7│                     160   ↵│
│                                │                                │
└────────────────────────────────┴────────────────────────────────┘
(1 row)

select draw(random_matrix('uint8', 8, 8, 1, 42)) as uop_a_source,
       draw(choose(random_matrix('uint8', 8, 8, 1, 42), 'triu', 0)) as uop_b_source
       from test_fixture \gset
\i sql/uop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 45%;">
--         <!-- Diagram A -->
\set draw_source :uop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="621pt" height="796pt"
--  viewBox="0.00 0.00 620.90 796.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 792)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-792 616.9,-792 616.9,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-537" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-535.1" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M8.79,-551.14C6.74,-560.92 8.99,-570.56 15.56,-570.56 19.76,-570.56 22.2,-566.6 22.87,-561.19"/>
-- <polygon fill="black" stroke="black" points="26.36,-560.93 22.32,-551.14 19.37,-561.31 26.36,-560.93"/>
-- <text text-anchor="middle" x="15.56" y="-573.16" font-family="Times,serif" font-size="8.00">65</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="98.67" cy="-249" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="98.67" y="-247.1" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M20.28,-521.82C26.14,-498.1 38,-450.83 49.11,-411 62.79,-361.96 80.22,-305.03 90.04,-273.4"/>
-- <polygon fill="black" stroke="black" points="93.43,-274.28 93.06,-263.69 86.75,-272.2 93.43,-274.28"/>
-- <text text-anchor="middle" x="57.11" y="-413.6" font-family="Times,serif" font-size="8.00">251</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="597.35" cy="-371" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="597.35" y="-369.1" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 0&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>0&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M18.33,-552.51C24.85,-605.92 49.7,-779 97.67,-779 97.67,-779 97.67,-779 515.23,-779 593.49,-779 597.38,-486.62 596.73,-396.88"/>
-- <polygon fill="black" stroke="black" points="600.23,-396.71 596.63,-386.74 593.23,-396.78 600.23,-396.71"/>
-- <text text-anchor="middle" x="306.45" y="-781.6" font-family="Times,serif" font-size="8.00">126</text>
-- </g>
-- <!-- 7 -->
-- <g id="node4" class="node">
-- <title>7</title>
-- <ellipse fill="none" stroke="black" cx="431.12" cy="-240" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="431.12" y="-238.1" font-family="Times,serif" font-size="8.00">7</text>
-- </g>
-- <!-- 0&#45;&gt;7 -->
-- <g id="edge4" class="edge">
-- <title>0&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M17.25,-521.43C21.37,-433.88 44.2,-7 97.67,-7 97.67,-7 97.67,-7 224.34,-7 290.71,-7 315.68,-15.04 363.56,-61 407,-102.69 422.3,-175.29 427.53,-213.98"/>
-- <polygon fill="black" stroke="black" points="424.11,-214.88 428.8,-224.38 431.06,-214.03 424.11,-214.88"/>
-- <text text-anchor="middle" x="223.34" y="-9.6" font-family="Times,serif" font-size="8.00">179</text>
-- </g>
-- <!-- 1&#45;&gt;0 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M95.82,-264.35C91.95,-294.59 81.92,-363.83 65.11,-420 55.02,-453.74 38.55,-491.04 27.64,-514.26"/>
-- <polygon fill="black" stroke="black" points="24.48,-512.76 23.34,-523.29 30.8,-515.77 24.48,-512.76"/>
-- <text text-anchor="middle" x="57.11" y="-464.6" font-family="Times,serif" font-size="8.00">190</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge6" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M100.13,-233.38C102.27,-192.06 114.22,-83 180.78,-83 180.78,-83 180.78,-83 307.45,-83 413.65,-83 509.11,-201.04 563.79,-281 577.4,-300.9 586.04,-327.16 590.97,-346.18"/>
-- <polygon fill="black" stroke="black" points="587.58,-347.02 593.34,-355.91 594.38,-345.37 587.58,-347.02"/>
-- <text text-anchor="middle" x="348.01" y="-95.6" font-family="Times,serif" font-size="8.00">67</text>
-- </g>
-- <!-- 1&#45;&gt;7 -->
-- <g id="edge10" class="edge">
-- <title>1&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M110.63,-238.84C116.72,-233.46 124.6,-226.97 132.23,-222 177.52,-192.45 195.51,-194.13 249.34,-189 308.43,-183.36 374.89,-211.53 408.36,-228.28"/>
-- <polygon fill="black" stroke="black" points="406.78,-231.4 417.27,-232.86 409.98,-225.17 406.78,-231.4"/>
-- <text text-anchor="middle" x="264.89" y="-191.6" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 3 -->
-- <g id="node5" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="348.01" cy="-383" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="348.01" y="-381.1" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 1&#45;&gt;3 -->
-- <g id="edge7" class="edge">
-- <title>1&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M112.53,-241.75C149.25,-222.12 255.66,-172.83 314.45,-225 333.83,-242.2 342.2,-317.08 345.36,-357.27"/>
-- <polygon fill="black" stroke="black" points="341.88,-357.66 346.1,-367.38 348.86,-357.15 341.88,-357.66"/>
-- <text text-anchor="middle" x="223.34" y="-207.6" font-family="Times,serif" font-size="8.00">233</text>
-- </g>
-- <!-- 4 -->
-- <g id="node6" class="node">
-- <title>4</title>
-- <ellipse fill="none" stroke="black" cx="514.23" cy="-459" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="514.23" y="-457.1" font-family="Times,serif" font-size="8.00">4</text>
-- </g>
-- <!-- 1&#45;&gt;4 -->
-- <g id="edge8" class="edge">
-- <title>1&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M103,-264.34C108.42,-288.8 119.8,-338.03 132.23,-379 175.08,-520.26 195.95,-587.79 332.45,-644 359.66,-655.2 372.03,-670.62 397.56,-656 463.07,-618.5 495.1,-527.89 507.23,-483.85"/>
-- <polygon fill="black" stroke="black" points="510.67,-484.53 509.83,-473.96 503.9,-482.74 510.67,-484.53"/>
-- <text text-anchor="middle" x="306.45" y="-637.6" font-family="Times,serif" font-size="8.00">85</text>
-- </g>
-- <!-- 5 -->
-- <g id="node7" class="node">
-- <title>5</title>
-- <ellipse fill="none" stroke="black" cx="181.78" cy="-449" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="181.78" y="-447.1" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 1&#45;&gt;5 -->
-- <g id="edge9" class="edge">
-- <title>1&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M105.37,-263.06C119.13,-296.99 154.26,-383.61 171.27,-425.54"/>
-- <polygon fill="black" stroke="black" points="168.08,-427 175.08,-434.95 174.57,-424.37 168.08,-427"/>
-- <text text-anchor="middle" x="140.23" y="-368.6" font-family="Times,serif" font-size="8.00">24</text>
-- </g>
-- <!-- 2&#45;&gt;1 -->
-- <g id="edge11" class="edge">
-- <title>2&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M596.32,-355.06C595.8,-284.05 589.08,0 515.23,0 388.56,0 388.56,0 388.56,0 328.12,0 171.92,-45.41 132.23,-91 115.29,-110.45 105.87,-183.7 101.92,-223.27"/>
-- <polygon fill="black" stroke="black" points="98.41,-223.17 100.95,-233.46 105.38,-223.84 98.41,-223.17"/>
-- <text text-anchor="middle" x="348.01" y="-9.6" font-family="Times,serif" font-size="8.00">84</text>
-- </g>
-- <!-- 2&#45;&gt;2 -->
-- <g id="edge12" class="edge">
-- <title>2&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M590.58,-385.14C588.53,-394.92 590.78,-404.56 597.35,-404.56 601.55,-404.56 603.99,-400.6 604.66,-395.19"/>
-- <polygon fill="black" stroke="black" points="608.15,-394.93 604.11,-385.14 601.16,-395.31 608.15,-394.93"/>
-- <text text-anchor="middle" x="597.35" y="-407.16" font-family="Times,serif" font-size="8.00">62</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge13" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M588.15,-358.43C582.31,-350.49 573.74,-340.68 563.79,-335 524.97,-312.84 509.06,-312.74 464.68,-318 426.95,-322.48 413.13,-316.85 381.56,-338 373.18,-343.62 366.21,-352.16 360.9,-360.3"/>
-- <polygon fill="black" stroke="black" points="357.75,-358.75 355.63,-369.13 363.76,-362.34 357.75,-358.75"/>
-- <text text-anchor="middle" x="472.68" y="-320.6" font-family="Times,serif" font-size="8.00">213</text>
-- </g>
-- <!-- 2&#45;&gt;4 -->
-- <g id="edge14" class="edge">
-- <title>2&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M583.3,-378.42C572.85,-384.79 558.26,-394.73 547.79,-406 539.55,-414.87 532.28,-426.15 526.71,-436.01"/>
-- <polygon fill="black" stroke="black" points="523.58,-434.45 521.92,-444.91 529.74,-437.77 523.58,-434.45"/>
-- <text text-anchor="middle" x="555.79" y="-408.6" font-family="Times,serif" font-size="8.00">123</text>
-- </g>
-- <!-- 2&#45;&gt;5 -->
-- <g id="edge15" class="edge">
-- <title>2&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M594.22,-386.53C586.8,-437.59 560.05,-597 515.23,-597 388.56,-597 388.56,-597 388.56,-597 302.41,-597 277.01,-570.16 215.34,-510 204.87,-499.78 196.99,-485.47 191.6,-473.27"/>
-- <polygon fill="black" stroke="black" points="194.7,-471.59 187.67,-463.67 188.22,-474.25 194.7,-471.59"/>
-- <text text-anchor="middle" x="389.56" y="-599.6" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 7&#45;&gt;1 -->
-- <g id="edge40" class="edge">
-- <title>7&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M426.67,-225.03C418.71,-194.73 396.03,-129 349.01,-129 180.78,-129 180.78,-129 180.78,-129 135.43,-129 113.72,-188.55 104.85,-223.75"/>
-- <polygon fill="black" stroke="black" points="101.37,-223.27 102.5,-233.8 108.19,-224.86 101.37,-223.27"/>
-- <text text-anchor="middle" x="264.89" y="-131.6" font-family="Times,serif" font-size="8.00">226</text>
-- </g>
-- <!-- 7&#45;&gt;2 -->
-- <g id="edge41" class="edge">
-- <title>7&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M446.75,-242.67C473.36,-248.24 530.05,-263.46 563.79,-297 577.26,-310.39 585.59,-330.31 590.45,-346.11"/>
-- <polygon fill="black" stroke="black" points="587.09,-347.1 593.15,-355.79 593.83,-345.21 587.09,-347.1"/>
-- <text text-anchor="middle" x="514.23" y="-274.6" font-family="Times,serif" font-size="8.00">231</text>
-- </g>
-- <!-- 7&#45;&gt;7 -->
-- <g id="edge44" class="edge">
-- <title>7&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M424.35,-254.14C422.3,-263.92 424.56,-273.56 431.12,-273.56 435.32,-273.56 437.76,-269.6 438.43,-264.19"/>
-- <polygon fill="black" stroke="black" points="441.92,-263.93 437.89,-254.14 434.93,-264.31 441.92,-263.93"/>
-- <text text-anchor="middle" x="431.12" y="-276.16" font-family="Times,serif" font-size="8.00">160</text>
-- </g>
-- <!-- 7&#45;&gt;4 -->
-- <g id="edge42" class="edge">
-- <title>7&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M434.57,-255.23C438.67,-278.44 448.16,-323.69 464.68,-359 469.95,-370.28 474.66,-371.1 480.68,-382 490.1,-399.1 498.61,-419.49 504.57,-434.99"/>
-- <polygon fill="black" stroke="black" points="501.3,-436.26 508.09,-444.39 507.86,-433.8 501.3,-436.26"/>
-- <text text-anchor="middle" x="472.68" y="-384.6" font-family="Times,serif" font-size="8.00">68</text>
-- </g>
-- <!-- 7&#45;&gt;5 -->
-- <g id="edge43" class="edge">
-- <title>7&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M416.6,-246.2C379.96,-263.56 277.41,-316 215.34,-386 205.22,-397.41 197.27,-412.53 191.76,-425.1"/>
-- <polygon fill="black" stroke="black" points="188.46,-423.93 187.87,-434.51 194.92,-426.61 188.46,-423.93"/>
-- <text text-anchor="middle" x="306.45" y="-316.6" font-family="Times,serif" font-size="8.00">35</text>
-- </g>
-- <!-- 3&#45;&gt;0 -->
-- <g id="edge16" class="edge">
-- <title>3&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M343.73,-398.12C330.83,-455.56 281.54,-657 224.34,-657 97.67,-657 97.67,-657 97.67,-657 52.32,-657 30.61,-597.45 21.74,-562.25"/>
-- <polygon fill="black" stroke="black" points="25.07,-561.14 19.39,-552.2 18.26,-562.73 25.07,-561.14"/>
-- <text text-anchor="middle" x="181.78" y="-659.6" font-family="Times,serif" font-size="8.00">56</text>
-- </g>
-- <!-- 3&#45;&gt;1 -->
-- <g id="edge17" class="edge">
-- <title>3&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M333.89,-375.89C293.68,-354.11 171.87,-288.11 121.66,-260.91"/>
-- <polygon fill="black" stroke="black" points="123.08,-257.7 112.62,-256.02 119.74,-263.86 123.08,-257.7"/>
-- <text text-anchor="middle" x="223.34" y="-322.6" font-family="Times,serif" font-size="8.00">108</text>
-- </g>
-- <!-- 3&#45;&gt;2 -->
-- <g id="edge18" class="edge">
-- <title>3&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M362.98,-377.64C384.45,-369.72 427.04,-355.26 464.68,-350 502.56,-344.7 546.39,-354.99 572.71,-362.95"/>
-- <polygon fill="black" stroke="black" points="571.94,-366.38 582.53,-366.07 574.06,-359.71 571.94,-366.38"/>
-- <text text-anchor="middle" x="472.68" y="-352.6" font-family="Times,serif" font-size="8.00">27</text>
-- </g>
-- <!-- 3&#45;&gt;7 -->
-- <g id="edge23" class="edge">
-- <title>3&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M353.43,-368.18C358.79,-351.28 368.74,-323.13 381.56,-301 386.53,-292.43 401.67,-273.74 413.74,-259.29"/>
-- <polygon fill="black" stroke="black" points="416.64,-261.28 420.4,-251.38 411.28,-256.78 416.64,-261.28"/>
-- <text text-anchor="middle" x="389.56" y="-303.6" font-family="Times,serif" font-size="8.00">205</text>
-- </g>
-- <!-- 3&#45;&gt;3 -->
-- <g id="edge19" class="edge">
-- <title>3&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M341.24,-397.14C339.19,-406.92 341.44,-416.56 348.01,-416.56 352.21,-416.56 354.65,-412.6 355.32,-407.19"/>
-- <polygon fill="black" stroke="black" points="358.81,-406.93 354.77,-397.14 351.82,-407.31 358.81,-406.93"/>
-- <text text-anchor="middle" x="348.01" y="-419.16" font-family="Times,serif" font-size="8.00">211</text>
-- </g>
-- <!-- 3&#45;&gt;4 -->
-- <g id="edge20" class="edge">
-- <title>3&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M360.13,-393.32C366.15,-398.52 373.9,-404.63 381.56,-409 416.81,-429.11 461.7,-444.16 488.91,-452.26"/>
-- <polygon fill="black" stroke="black" points="488.17,-455.69 498.75,-455.11 490.12,-448.96 488.17,-455.69"/>
-- <text text-anchor="middle" x="431.12" y="-439.6" font-family="Times,serif" font-size="8.00">15</text>
-- </g>
-- <!-- 3&#45;&gt;5 -->
-- <g id="edge21" class="edge">
-- <title>3&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M332.52,-381.34C313.21,-379.56 278.15,-377.89 249.34,-385 232.94,-389.05 228.1,-390.93 215.34,-402 207.41,-408.88 200.47,-418.09 195.07,-426.54"/>
-- <polygon fill="black" stroke="black" points="191.98,-424.89 189.82,-435.26 197.98,-428.49 191.98,-424.89"/>
-- <text text-anchor="middle" x="264.89" y="-387.6" font-family="Times,serif" font-size="8.00">136</text>
-- </g>
-- <!-- 6 -->
-- <g id="node8" class="node">
-- <title>6</title>
-- <ellipse fill="none" stroke="black" cx="264.89" cy="-461" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="264.89" y="-459.1" font-family="Times,serif" font-size="8.00">6</text>
-- </g>
-- <!-- 3&#45;&gt;6 -->
-- <g id="edge22" class="edge">
-- <title>3&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M341.53,-397.54C336.23,-409.95 327.13,-427.54 314.45,-439 307.44,-445.33 298.3,-450.11 289.85,-453.57"/>
-- <polygon fill="black" stroke="black" points="288.59,-450.31 280.4,-457.04 291,-456.88 288.59,-450.31"/>
-- <text text-anchor="middle" x="306.45" y="-451.6" font-family="Times,serif" font-size="8.00">140</text>
-- </g>
-- <!-- 4&#45;&gt;0 -->
-- <g id="edge24" class="edge">
-- <title>4&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M512.17,-474.56C507.69,-533.68 488.03,-741 432.12,-741 97.67,-741 97.67,-741 97.67,-741 59.62,-741 31.57,-616.88 21.08,-562.27"/>
-- <polygon fill="black" stroke="black" points="24.5,-561.52 19.22,-552.33 17.62,-562.81 24.5,-561.52"/>
-- <text text-anchor="middle" x="264.89" y="-743.6" font-family="Times,serif" font-size="8.00">31</text>
-- </g>
-- <!-- 4&#45;&gt;2 -->
-- <g id="edge25" class="edge">
-- <title>4&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M527.02,-449.46C537.24,-440.93 552.18,-427.82 563.79,-415 570.21,-407.91 576.61,-399.6 582.02,-392.12"/>
-- <polygon fill="black" stroke="black" points="584.95,-394.03 587.85,-383.84 579.23,-390 584.95,-394.03"/>
-- <text text-anchor="middle" x="555.79" y="-432.6" font-family="Times,serif" font-size="8.00">9</text>
-- </g>
-- <!-- 4&#45;&gt;3 -->
-- <g id="edge26" class="edge">
-- <title>4&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M501.65,-449.34C488.89,-439.1 467.4,-423.05 446.68,-413 422.86,-401.46 393.64,-393.18 373.39,-388.28"/>
-- <polygon fill="black" stroke="black" points="373.96,-384.82 363.43,-385.97 372.38,-391.64 373.96,-384.82"/>
-- <text text-anchor="middle" x="431.12" y="-415.6" font-family="Times,serif" font-size="8.00">104</text>
-- </g>
-- <!-- 4&#45;&gt;4 -->
-- <g id="edge27" class="edge">
-- <title>4&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M507.46,-473.14C505.41,-482.92 507.67,-492.56 514.23,-492.56 518.44,-492.56 520.87,-488.6 521.54,-483.19"/>
-- <polygon fill="black" stroke="black" points="525.03,-482.93 521,-473.14 518.04,-483.31 525.03,-482.93"/>
-- <text text-anchor="middle" x="514.23" y="-495.16" font-family="Times,serif" font-size="8.00">104</text>
-- </g>
-- <!-- 4&#45;&gt;5 -->
-- <g id="edge28" class="edge">
-- <title>4&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M500.4,-466.8C494.58,-469.93 487.5,-473.22 480.68,-475 283.09,-526.68 305.72,-496.41 249.34,-486 233.43,-483.06 229.53,-480.76 215.34,-473 211.06,-470.66 206.71,-467.83 202.65,-464.94"/>
-- <polygon fill="black" stroke="black" points="204.42,-461.9 194.32,-458.7 200.22,-467.5 204.42,-461.9"/>
-- <text text-anchor="middle" x="348.01" y="-506.6" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 4&#45;&gt;6 -->
-- <g id="edge29" class="edge">
-- <title>4&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M498.65,-460.07C493.04,-460.43 486.56,-460.8 480.68,-461 406.84,-463.49 388.33,-461.78 314.45,-462 307.34,-462.02 305.56,-462.11 298.45,-462 295.88,-461.96 293.19,-461.9 290.51,-461.84"/>
-- <polygon fill="black" stroke="black" points="290.58,-458.34 280.48,-461.54 290.37,-465.33 290.58,-458.34"/>
-- <text text-anchor="middle" x="389.56" y="-464.6" font-family="Times,serif" font-size="8.00">149</text>
-- </g>
-- <!-- 5&#45;&gt;0 -->
-- <g id="edge30" class="edge">
-- <title>5&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M167.56,-456.09C139.39,-471.18 73.24,-506.62 38.6,-525.19"/>
-- <polygon fill="black" stroke="black" points="36.88,-522.14 29.72,-529.95 40.19,-528.31 36.88,-522.14"/>
-- <text text-anchor="middle" x="98.67" y="-502.6" font-family="Times,serif" font-size="8.00">114</text>
-- </g>
-- <!-- 5&#45;&gt;1 -->
-- <g id="edge31" class="edge">
-- <title>5&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M178.76,-433.59C175.09,-408.63 166.01,-358.2 148.23,-319 139.9,-300.66 126.7,-282.02 116.16,-268.6"/>
-- <polygon fill="black" stroke="black" points="118.69,-266.17 109.69,-260.58 113.24,-270.56 118.69,-266.17"/>
-- <text text-anchor="middle" x="140.23" y="-321.6" font-family="Times,serif" font-size="8.00">126</text>
-- </g>
-- <!-- 5&#45;&gt;2 -->
-- <g id="edge32" class="edge">
-- <title>5&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M187.89,-463.63C195.08,-483.9 208.13,-519.34 215.34,-531 227.26,-550.27 231.6,-554.9 249.34,-569 347.99,-647.44 418.4,-669.96 529.79,-611 553.54,-598.43 553.74,-585.92 563.79,-561 586.29,-505.21 593.25,-434.09 595.39,-396.68"/>
-- <polygon fill="black" stroke="black" points="598.89,-396.79 595.9,-386.63 591.9,-396.44 598.89,-396.79"/>
-- <text text-anchor="middle" x="389.56" y="-645.6" font-family="Times,serif" font-size="8.00">52</text>
-- </g>
-- <!-- 5&#45;&gt;7 -->
-- <g id="edge36" class="edge">
-- <title>5&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M183.11,-433.17C184.37,-406.03 190.1,-349.79 215.34,-311 240.62,-272.15 254.98,-264.1 298.45,-248 333.75,-234.93 377.99,-235.34 405.15,-237.32"/>
-- <polygon fill="black" stroke="black" points="405.07,-240.82 415.33,-238.19 405.67,-233.85 405.07,-240.82"/>
-- <text text-anchor="middle" x="306.45" y="-250.6" font-family="Times,serif" font-size="8.00">254</text>
-- </g>
-- <!-- 5&#45;&gt;3 -->
-- <g id="edge33" class="edge">
-- <title>5&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M196.5,-443.49C224.57,-432.21 288.82,-406.39 323.6,-392.41"/>
-- <polygon fill="black" stroke="black" points="325.01,-395.61 332.98,-388.64 322.39,-389.12 325.01,-395.61"/>
-- <text text-anchor="middle" x="264.89" y="-423.6" font-family="Times,serif" font-size="8.00">64</text>
-- </g>
-- <!-- 5&#45;&gt;4 -->
-- <g id="edge34" class="edge">
-- <title>5&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M190.39,-462.32C196.2,-471.46 204.97,-483.3 215.34,-491 246.32,-513.98 260.23,-510.83 298.45,-516 379.52,-526.97 410.38,-531.84 480.68,-490 486.18,-486.73 491.49,-482.37 496.18,-477.96"/>
-- <polygon fill="black" stroke="black" points="498.85,-480.24 503.39,-470.67 493.87,-475.31 498.85,-480.24"/>
-- <text text-anchor="middle" x="348.01" y="-525.6" font-family="Times,serif" font-size="8.00">16</text>
-- </g>
-- <!-- 5&#45;&gt;6 -->
-- <g id="edge35" class="edge">
-- <title>5&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M196.53,-454.08C202.27,-455.97 209.04,-457.92 215.34,-459 222.91,-460.3 231.24,-460.92 238.83,-461.19"/>
-- <polygon fill="black" stroke="black" points="238.85,-464.69 248.91,-461.37 238.98,-457.7 238.85,-464.69"/>
-- <text text-anchor="middle" x="223.34" y="-462.6" font-family="Times,serif" font-size="8.00">68</text>
-- </g>
-- <!-- 6&#45;&gt;0 -->
-- <g id="edge37" class="edge">
-- <title>6&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M250.17,-466.66C218.26,-479.62 136.34,-511.64 65.11,-529 57.35,-530.89 48.78,-532.47 41.03,-533.71"/>
-- <polygon fill="black" stroke="black" points="40.49,-530.25 31.12,-535.19 41.53,-537.17 40.49,-530.25"/>
-- <text text-anchor="middle" x="140.23" y="-511.6" font-family="Times,serif" font-size="8.00">76</text>
-- </g>
-- <!-- 6&#45;&gt;3 -->
-- <g id="edge38" class="edge">
-- <title>6&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M276.83,-450.48C290.21,-437.62 313.04,-415.66 329.02,-400.3"/>
-- <polygon fill="black" stroke="black" points="331.46,-402.81 336.24,-393.35 326.61,-397.76 331.46,-402.81"/>
-- <text text-anchor="middle" x="306.45" y="-430.6" font-family="Times,serif" font-size="8.00">31</text>
-- </g>
-- <!-- 6&#45;&gt;5 -->
-- <g id="edge39" class="edge">
-- <title>6&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M250.2,-455.33C244.47,-453.24 237.69,-451.11 231.34,-450 223.66,-448.66 215.2,-448.15 207.52,-448.06"/>
-- <polygon fill="black" stroke="black" points="207.31,-444.56 197.34,-448.15 207.37,-451.56 207.31,-444.56"/>
-- <text text-anchor="middle" x="223.34" y="-452.6" font-family="Times,serif" font-size="8.00">143</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 45%;">
--         <!-- Diagram B -->
\set draw_source :uop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="533pt" height="347pt"
--  viewBox="0.00 0.00 532.79 346.56" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 342.56)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-342.56 528.79,-342.56 528.79,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-208.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-206.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M8.79,-222.69C6.74,-232.48 8.99,-242.11 15.56,-242.11 19.76,-242.11 22.2,-238.16 22.87,-232.74"/>
-- <polygon fill="black" stroke="black" points="26.36,-232.49 22.32,-222.69 19.37,-232.87 26.36,-232.49"/>
-- <text text-anchor="middle" x="15.56" y="-244.71" font-family="Times,serif" font-size="8.00">65</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="98.67" cy="-208.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="98.67" y="-206.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.43,-208.56C42.98,-208.56 59.25,-208.56 72.77,-208.56"/>
-- <polygon fill="black" stroke="black" points="72.89,-212.06 82.89,-208.56 72.89,-205.06 72.89,-212.06"/>
-- <text text-anchor="middle" x="57.11" y="-211.16" font-family="Times,serif" font-size="8.00">251</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="176.78" cy="-124.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="176.78" y="-122.66" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 0&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>0&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M29.59,-201.68C56.76,-187.35 119.76,-154.11 153.5,-136.31"/>
-- <polygon fill="black" stroke="black" points="155.36,-139.29 162.57,-131.53 152.09,-133.1 155.36,-139.29"/>
-- <text text-anchor="middle" x="98.67" y="-174.16" font-family="Times,serif" font-size="8.00">126</text>
-- </g>
-- <!-- 7 -->
-- <g id="node4" class="node">
-- <title>7</title>
-- <ellipse fill="none" stroke="black" cx="509.23" cy="-256.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="509.23" y="-254.66" font-family="Times,serif" font-size="8.00">7</text>
-- </g>
-- <!-- 0&#45;&gt;7 -->
-- <g id="edge4" class="edge">
-- <title>0&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M19.34,-223.88C26.24,-256.44 47.34,-329.56 97.67,-329.56 97.67,-329.56 97.67,-329.56 427.12,-329.56 457.95,-329.56 482.37,-300.05 496.06,-278.56"/>
-- <polygon fill="black" stroke="black" points="499.09,-280.32 501.26,-269.95 493.09,-276.7 499.09,-280.32"/>
-- <text text-anchor="middle" x="259.89" y="-332.16" font-family="Times,serif" font-size="8.00">179</text>
-- </g>
-- <!-- 1&#45;&gt;2 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M109.93,-197.23C122.49,-183.37 143.91,-159.73 158.9,-143.18"/>
-- <polygon fill="black" stroke="black" points="161.56,-145.47 165.68,-135.71 156.37,-140.77 161.56,-145.47"/>
-- <text text-anchor="middle" x="137.73" y="-174.16" font-family="Times,serif" font-size="8.00">67</text>
-- </g>
-- <!-- 1&#45;&gt;7 -->
-- <g id="edge9" class="edge">
-- <title>1&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M106.07,-222.66C117,-244.39 141.46,-283.56 175.78,-283.56 175.78,-283.56 175.78,-283.56 427.12,-283.56 447.89,-283.56 470.19,-275.49 486.15,-268.17"/>
-- <polygon fill="black" stroke="black" points="487.71,-271.3 495.19,-263.79 484.66,-265 487.71,-271.3"/>
-- <text text-anchor="middle" x="301.45" y="-286.16" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 3 -->
-- <g id="node5" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="259.89" cy="-124.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="259.89" y="-122.66" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 1&#45;&gt;3 -->
-- <g id="edge6" class="edge">
-- <title>1&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M114.09,-205.16C132.86,-200.4 166.32,-190.7 192.34,-176.56 209.88,-167.02 227.59,-152.92 240.33,-141.8"/>
-- <polygon fill="black" stroke="black" points="242.81,-144.28 247.93,-135.01 238.14,-139.06 242.81,-144.28"/>
-- <text text-anchor="middle" x="176.78" y="-192.16" font-family="Times,serif" font-size="8.00">233</text>
-- </g>
-- <!-- 4 -->
-- <g id="node6" class="node">
-- <title>4</title>
-- <ellipse fill="none" stroke="black" cx="343.01" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="343.01" y="-13.66" font-family="Times,serif" font-size="8.00">4</text>
-- </g>
-- <!-- 1&#45;&gt;4 -->
-- <g id="edge7" class="edge">
-- <title>1&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M107.77,-195.41C109.9,-191.9 112.17,-188.1 114.23,-184.56 135.87,-147.2 130.14,-129.51 161.23,-99.56 206.82,-55.63 279.57,-31.59 317.38,-21.44"/>
-- <polygon fill="black" stroke="black" points="318.68,-24.72 327.5,-18.84 316.94,-17.94 318.68,-24.72"/>
-- <text text-anchor="middle" x="218.34" y="-66.16" font-family="Times,serif" font-size="8.00">85</text>
-- </g>
-- <!-- 5 -->
-- <g id="node7" class="node">
-- <title>5</title>
-- <ellipse fill="none" stroke="black" cx="426.12" cy="-193.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="426.12" y="-191.66" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 1&#45;&gt;5 -->
-- <g id="edge8" class="edge">
-- <title>1&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M111.21,-218.28C125.44,-229.24 150.8,-245.56 175.78,-245.56 175.78,-245.56 175.78,-245.56 344.01,-245.56 369.36,-245.56 393.13,-227.33 408.3,-212.45"/>
-- <polygon fill="black" stroke="black" points="410.98,-214.72 415.41,-205.1 405.94,-209.85 410.98,-214.72"/>
-- <text text-anchor="middle" x="259.89" y="-248.16" font-family="Times,serif" font-size="8.00">24</text>
-- </g>
-- <!-- 2&#45;&gt;2 -->
-- <g id="edge10" class="edge">
-- <title>2&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M170.28,-139.04C168.46,-148.71 170.62,-158.11 176.78,-158.11 180.63,-158.11 182.92,-154.44 183.65,-149.32"/>
-- <polygon fill="black" stroke="black" points="187.14,-148.91 183.28,-139.04 180.14,-149.16 187.14,-148.91"/>
-- <text text-anchor="middle" x="176.78" y="-160.71" font-family="Times,serif" font-size="8.00">62</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge11" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M192.66,-124.56C204.21,-124.56 220.47,-124.56 234,-124.56"/>
-- <polygon fill="black" stroke="black" points="234.11,-128.06 244.11,-124.56 234.11,-121.06 234.11,-128.06"/>
-- <text text-anchor="middle" x="218.34" y="-127.16" font-family="Times,serif" font-size="8.00">213</text>
-- </g>
-- <!-- 2&#45;&gt;4 -->
-- <g id="edge12" class="edge">
-- <title>2&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M190.13,-116.36C218.06,-97.82 286.4,-52.46 321.08,-29.45"/>
-- <polygon fill="black" stroke="black" points="323.12,-32.29 329.52,-23.84 319.25,-26.46 323.12,-32.29"/>
-- <text text-anchor="middle" x="259.89" y="-81.16" font-family="Times,serif" font-size="8.00">123</text>
-- </g>
-- <!-- 2&#45;&gt;5 -->
-- <g id="edge13" class="edge">
-- <title>2&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M187.87,-135.49C199.97,-147.81 221.5,-167.32 244.34,-176.56 296.78,-197.77 364.52,-197.6 400.35,-195.6"/>
-- <polygon fill="black" stroke="black" points="400.65,-199.08 410.4,-194.94 400.19,-192.1 400.65,-199.08"/>
-- <text text-anchor="middle" x="301.45" y="-195.16" font-family="Times,serif" font-size="8.00">5</text>
-- </g>
-- <!-- 7&#45;&gt;7 -->
-- <g id="edge24" class="edge">
-- <title>7&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M502.46,-270.69C500.41,-280.48 502.67,-290.11 509.23,-290.11 513.44,-290.11 515.87,-286.16 516.54,-280.74"/>
-- <polygon fill="black" stroke="black" points="520.03,-280.49 516,-270.69 513.04,-280.87 520.03,-280.49"/>
-- <text text-anchor="middle" x="509.23" y="-292.71" font-family="Times,serif" font-size="8.00">160</text>
-- </g>
-- <!-- 3&#45;&gt;7 -->
-- <g id="edge18" class="edge">
-- <title>3&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M275.43,-123.29C318.82,-119.86 446.19,-112.25 475.68,-138.56 501.6,-161.68 507.69,-203.39 508.71,-230.52"/>
-- <polygon fill="black" stroke="black" points="505.21,-230.87 508.88,-240.82 512.21,-230.76 505.21,-230.87"/>
-- <text text-anchor="middle" x="384.56" y="-122.16" font-family="Times,serif" font-size="8.00">205</text>
-- </g>
-- <!-- 3&#45;&gt;3 -->
-- <g id="edge14" class="edge">
-- <title>3&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M253.13,-138.69C251.08,-148.48 253.33,-158.11 259.89,-158.11 264.1,-158.11 266.54,-154.16 267.2,-148.74"/>
-- <polygon fill="black" stroke="black" points="270.7,-148.49 266.66,-138.69 263.71,-148.87 270.7,-148.49"/>
-- <text text-anchor="middle" x="259.89" y="-160.71" font-family="Times,serif" font-size="8.00">211</text>
-- </g>
-- <!-- 3&#45;&gt;4 -->
-- <g id="edge15" class="edge">
-- <title>3&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M268.87,-111.85C275.28,-101.82 284.62,-87.58 293.45,-75.56 303.66,-61.65 315.88,-46.56 325.51,-34.98"/>
-- <polygon fill="black" stroke="black" points="328.25,-37.16 332,-27.25 322.89,-32.66 328.25,-37.16"/>
-- <text text-anchor="middle" x="301.45" y="-78.16" font-family="Times,serif" font-size="8.00">15</text>
-- </g>
-- <!-- 3&#45;&gt;5 -->
-- <g id="edge16" class="edge">
-- <title>3&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M274.5,-130.45C280.33,-132.96 287.22,-135.92 293.45,-138.56 331.31,-154.6 375.42,-172.96 401.77,-183.89"/>
-- <polygon fill="black" stroke="black" points="400.68,-187.23 411.26,-187.82 403.36,-180.76 400.68,-187.23"/>
-- <text text-anchor="middle" x="343.01" y="-167.16" font-family="Times,serif" font-size="8.00">136</text>
-- </g>
-- <!-- 6 -->
-- <g id="node8" class="node">
-- <title>6</title>
-- <ellipse fill="none" stroke="black" cx="509.23" cy="-86.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="509.23" y="-84.66" font-family="Times,serif" font-size="8.00">6</text>
-- </g>
-- <!-- 3&#45;&gt;6 -->
-- <g id="edge17" class="edge">
-- <title>3&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M274.7,-119.02C280.45,-116.84 287.21,-114.41 293.45,-112.56 329.77,-101.76 339.04,-98.8 376.56,-93.56 413.46,-88.4 456.66,-86.97 483.24,-86.61"/>
-- <polygon fill="black" stroke="black" points="483.57,-90.11 493.54,-86.52 483.51,-83.11 483.57,-90.11"/>
-- <text text-anchor="middle" x="384.56" y="-96.16" font-family="Times,serif" font-size="8.00">140</text>
-- </g>
-- <!-- 4&#45;&gt;4 -->
-- <g id="edge19" class="edge">
-- <title>4&#45;&gt;4</title>
-- <path fill="none" stroke="black" d="M336.24,-29.69C334.19,-39.48 336.44,-49.11 343.01,-49.11 347.21,-49.11 349.65,-45.16 350.32,-39.74"/>
-- <polygon fill="black" stroke="black" points="353.81,-39.49 349.77,-29.69 346.82,-39.87 353.81,-39.49"/>
-- <text text-anchor="middle" x="343.01" y="-51.71" font-family="Times,serif" font-size="8.00">104</text>
-- </g>
-- <!-- 4&#45;&gt;5 -->
-- <g id="edge20" class="edge">
-- <title>4&#45;&gt;5</title>
-- <path fill="none" stroke="black" d="M346.1,-30.96C349.74,-54.4 358.64,-99.94 376.56,-134.56 381,-143.12 396.07,-161 408.26,-174.85"/>
-- <polygon fill="black" stroke="black" points="405.74,-177.28 415,-182.43 410.97,-172.63 405.74,-177.28"/>
-- <text text-anchor="middle" x="384.56" y="-157.16" font-family="Times,serif" font-size="8.00">107</text>
-- </g>
-- <!-- 4&#45;&gt;6 -->
-- <g id="edge21" class="edge">
-- <title>4&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M357.45,-21.37C385.47,-33.48 450.45,-61.57 485.25,-76.62"/>
-- <polygon fill="black" stroke="black" points="484.04,-79.91 494.61,-80.67 486.82,-73.48 484.04,-79.91"/>
-- <text text-anchor="middle" x="426.12" y="-60.16" font-family="Times,serif" font-size="8.00">149</text>
-- </g>
-- <!-- 5&#45;&gt;7 -->
-- <g id="edge23" class="edge">
-- <title>5&#45;&gt;7</title>
-- <path fill="none" stroke="black" d="M439.09,-202.85C452.1,-212.96 473.11,-229.27 488.55,-241.27"/>
-- <polygon fill="black" stroke="black" points="486.43,-244.06 496.48,-247.43 490.73,-238.53 486.43,-244.06"/>
-- <text text-anchor="middle" x="467.68" y="-233.16" font-family="Times,serif" font-size="8.00">254</text>
-- </g>
-- <!-- 5&#45;&gt;6 -->
-- <g id="edge22" class="edge">
-- <title>5&#45;&gt;6</title>
-- <path fill="none" stroke="black" d="M436.42,-181.28C450.24,-163.06 476.32,-128.65 492.96,-106.7"/>
-- <polygon fill="black" stroke="black" points="495.78,-108.77 499.04,-98.69 490.21,-104.54 495.78,-108.77"/>
-- <text text-anchor="middle" x="467.68" y="-152.16" font-family="Times,serif" font-size="8.00">68</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Kronecker
--
-- The `kronecker()` function takes two input matrices, and replaces
-- every element in the second matrix with a new submatrix of the
-- first.  This "expands" the matrix exponentially.  This is useful
-- for constructing synthetic graphs with specific power law
-- distributions.
--
select print(s) as s, semiring, print(s) as s, print(kronecker(s, s, semiring)) as kronecker from test_fixture;
┌──────────────┬──────────────────┬──────────────┬────────────────────┐
│      s       │     semiring     │      s       │     kronecker      │
├──────────────┼──────────────────┼──────────────┼────────────────────┤
│      0  1   ↵│ plus_times_int32 │      0  1   ↵│      0  1  2  3   ↵│
│    ──────   ↵│                  │    ──────   ↵│    ────────────   ↵│
│  0│  1  1   ↵│                  │  0│  1  1   ↵│  0│  1  1  1  1   ↵│
│  1│     1   ↵│                  │  1│     1   ↵│  1│     1     1   ↵│
│              │                  │              │  2│        1  1   ↵│
│              │                  │              │  3│           1   ↵│
│              │                  │              │                    │
└──────────────┴──────────────────┴──────────────┴────────────────────┘
(1 row)

select draw(s) as binop_a_source, draw(s) as binop_b_source, draw(kronecker(s, s, semiring)) as binop_c_source from test_fixture \gset
\i sql/binop.sql
-- <table style="width: 100%; table-layout: fixed;" class="dot-table">
--   <tr>
--     <td style="width: 30%;">
--         <!-- Diagram A -->
\set draw_source :binop_a_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="112pt" height="66pt"
--  viewBox="0.00 0.00 112.23 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 108.23,-62.11 108.23,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.4,-30.04C7.67,-39.71 9.72,-49.11 15.56,-49.11 19.2,-49.11 21.37,-45.44 22.06,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.55,-39.92 21.71,-30.04 18.56,-40.16 25.55,-39.92"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.29,-15.56C40.35,-15.56 52.19,-15.56 62.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="62.95,-19.06 72.95,-15.56 62.95,-12.06 62.95,-19.06"/>
-- <text text-anchor="middle" x="52.11" y="-18.16" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M82.51,-30.04C80.78,-39.71 82.83,-49.11 88.67,-49.11 92.32,-49.11 94.49,-45.44 95.18,-40.32"/>
-- <polygon fill="black" stroke="black" points="98.66,-39.92 94.82,-30.04 91.67,-40.16 98.66,-39.92"/>
-- <text text-anchor="middle" x="88.67" y="-51.71" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">op</td>
--     <td style="width: 30%;">
--         <!-- Diagram B -->
\set draw_source :binop_b_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="112pt" height="66pt"
--  viewBox="0.00 0.00 112.23 66.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 62.11)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-62.11 108.23,-62.11 108.23,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-13.66" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.4,-30.04C7.67,-39.71 9.72,-49.11 15.56,-49.11 19.2,-49.11 21.37,-45.44 22.06,-40.32"/>
-- <polygon fill="black" stroke="black" points="25.55,-39.92 21.71,-30.04 18.56,-40.16 25.55,-39.92"/>
-- <text text-anchor="middle" x="15.56" y="-51.71" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-15.56" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-13.66" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M31.29,-15.56C40.35,-15.56 52.19,-15.56 62.68,-15.56"/>
-- <polygon fill="black" stroke="black" points="62.95,-19.06 72.95,-15.56 62.95,-12.06 62.95,-19.06"/>
-- <text text-anchor="middle" x="52.11" y="-18.16" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge3" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M82.51,-30.04C80.78,-39.71 82.83,-49.11 88.67,-49.11 92.32,-49.11 94.49,-45.44 95.18,-40.32"/>
-- <polygon fill="black" stroke="black" points="98.66,-39.92 94.82,-30.04 91.67,-40.16 98.66,-39.92"/>
-- <text text-anchor="middle" x="88.67" y="-51.71" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--     <td style="font-size: 30px; vertical-align: middle;">=</td>
--     <td style="width: 30%;">
--         <!-- Diagram C -->
\set draw_source :binop_c_source
\i sql/draw.sql
\setenv draw_source :draw_source
\! echo $draw_source | dot -Tsvg -Nnodesep=0.1 -Nranksep=0.1 -Nwidth=0.05 -Nheight=0.05 -Nfontsize=8 -Efontsize=8 | sed '/<!DOCTYPE/,/>/d; /<?xml/,/>/d' | sed '1i<div>' | sed '$a</div>\n' | sed 's/^/-- /'
-- <div>
-- <!-- Title: %3 Pages: 1 -->
-- <svg width="185pt" height="163pt"
--  viewBox="0.00 0.00 185.34 163.33" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
-- <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 159.33)">
-- <title>%3</title>
-- <polygon fill="white" stroke="transparent" points="-4,4 -4,-159.33 181.34,-159.33 181.34,4 -4,4"/>
-- <!-- 0 -->
-- <g id="node1" class="node">
-- <title>0</title>
-- <ellipse fill="none" stroke="black" cx="15.56" cy="-36.77" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="15.56" y="-34.87" font-family="Times,serif" font-size="8.00">0</text>
-- </g>
-- <!-- 0&#45;&gt;0 -->
-- <g id="edge1" class="edge">
-- <title>0&#45;&gt;0</title>
-- <path fill="none" stroke="black" d="M9.4,-51.26C7.67,-60.92 9.72,-70.33 15.56,-70.33 19.2,-70.33 21.37,-66.65 22.06,-61.54"/>
-- <polygon fill="black" stroke="black" points="25.55,-61.13 21.71,-51.26 18.56,-61.37 25.55,-61.13"/>
-- <text text-anchor="middle" x="15.56" y="-72.93" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1 -->
-- <g id="node2" class="node">
-- <title>1</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-112.77" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-110.87" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 0&#45;&gt;1 -->
-- <g id="edge2" class="edge">
-- <title>0&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M26.75,-47.66C38.15,-59.85 56.82,-79.81 70.5,-94.42"/>
-- <polygon fill="black" stroke="black" points="68.11,-96.99 77.5,-101.9 73.22,-92.21 68.11,-96.99"/>
-- <text text-anchor="middle" x="52.11" y="-79.37" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2 -->
-- <g id="node3" class="node">
-- <title>2</title>
-- <ellipse fill="none" stroke="black" cx="88.67" cy="-36.77" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="88.67" y="-34.87" font-family="Times,serif" font-size="8.00">2</text>
-- </g>
-- <!-- 0&#45;&gt;2 -->
-- <g id="edge3" class="edge">
-- <title>0&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M31.29,-36.77C40.35,-36.77 52.19,-36.77 62.68,-36.77"/>
-- <polygon fill="black" stroke="black" points="62.95,-40.27 72.95,-36.77 62.95,-33.27 62.95,-40.27"/>
-- <text text-anchor="middle" x="52.11" y="-39.37" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3 -->
-- <g id="node4" class="node">
-- <title>3</title>
-- <ellipse fill="none" stroke="black" cx="161.78" cy="-36.77" rx="15.61" ry="15.61"/>
-- <text text-anchor="middle" x="161.78" y="-34.87" font-family="Times,serif" font-size="8.00">3</text>
-- </g>
-- <!-- 0&#45;&gt;3 -->
-- <g id="edge4" class="edge">
-- <title>0&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M28.24,-27.13C39.1,-18.84 56.11,-7.49 73.11,-2.77 86.44,0.92 90.9,0.92 104.23,-2.77 117.37,-6.42 130.53,-14.03 140.84,-21.13"/>
-- <polygon fill="black" stroke="black" points="138.95,-24.09 149.1,-27.13 143.06,-18.42 138.95,-24.09"/>
-- <text text-anchor="middle" x="88.67" y="-5.37" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;1 -->
-- <g id="edge5" class="edge">
-- <title>1&#45;&gt;1</title>
-- <path fill="none" stroke="black" d="M82.51,-127.26C80.78,-136.92 82.83,-146.33 88.67,-146.33 92.32,-146.33 94.49,-142.65 95.18,-137.54"/>
-- <polygon fill="black" stroke="black" points="98.66,-137.13 94.82,-127.26 91.67,-137.37 98.66,-137.13"/>
-- <text text-anchor="middle" x="88.67" y="-148.93" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 1&#45;&gt;3 -->
-- <g id="edge6" class="edge">
-- <title>1&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M99.86,-101.88C111.26,-89.69 129.94,-69.74 143.61,-55.13"/>
-- <polygon fill="black" stroke="black" points="146.34,-57.33 150.61,-47.64 141.22,-52.55 146.34,-57.33"/>
-- <text text-anchor="middle" x="125.23" y="-79.37" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;2 -->
-- <g id="edge7" class="edge">
-- <title>2&#45;&gt;2</title>
-- <path fill="none" stroke="black" d="M82.51,-51.26C80.78,-60.92 82.83,-70.33 88.67,-70.33 92.32,-70.33 94.49,-66.65 95.18,-61.54"/>
-- <polygon fill="black" stroke="black" points="98.66,-61.13 94.82,-51.26 91.67,-61.37 98.66,-61.13"/>
-- <text text-anchor="middle" x="88.67" y="-72.93" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 2&#45;&gt;3 -->
-- <g id="edge8" class="edge">
-- <title>2&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M104.4,-36.77C113.46,-36.77 125.3,-36.77 135.8,-36.77"/>
-- <polygon fill="black" stroke="black" points="136.07,-40.27 146.07,-36.77 136.07,-33.27 136.07,-40.27"/>
-- <text text-anchor="middle" x="125.23" y="-39.37" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- <!-- 3&#45;&gt;3 -->
-- <g id="edge9" class="edge">
-- <title>3&#45;&gt;3</title>
-- <path fill="none" stroke="black" d="M155.63,-51.26C153.89,-60.92 155.95,-70.33 161.78,-70.33 165.43,-70.33 167.6,-66.65 168.29,-61.54"/>
-- <polygon fill="black" stroke="black" points="171.78,-61.13 167.94,-51.26 164.78,-61.37 171.78,-61.13"/>
-- <text text-anchor="middle" x="161.78" y="-72.93" font-family="Times,serif" font-size="8.00">1</text>
-- </g>
-- </g>
-- </svg>
-- </div>
-- 
--     </td>
--   </tr>
-- </table>
-- ## Kronecker Power
--
-- There's a special function for exponentiating a matrix to itself a
-- certain number of times, `kronpower`:
select print(kronpower(s, 2)) from test_fixture;
┌────────────────────────────────────────────────────────┐
│                         print                          │
├────────────────────────────────────────────────────────┤
│      0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15   ↵│
│    ────────────────────────────────────────────────   ↵│
│  0│  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1   ↵│
│  1│     1     1     1     1     1     1     1     1   ↵│
│  2│        1  1        1  1        1  1        1  1   ↵│
│  3│           1           1           1           1   ↵│
│  4│              1  1  1  1              1  1  1  1   ↵│
│  5│                 1     1                 1     1   ↵│
│  6│                    1  1                    1  1   ↵│
│  7│                       1                       1   ↵│
│  8│                          1  1  1  1  1  1  1  1   ↵│
│  9│                             1     1     1     1   ↵│
│ 10│                                1  1        1  1   ↵│
│ 11│                                   1           1   ↵│
│ 12│                                      1  1  1  1   ↵│
│ 13│                                         1     1   ↵│
│ 14│                                            1  1   ↵│
│ 15│                                               1   ↵│
│                                                        │
└────────────────────────────────────────────────────────┘
(1 row)

-- Kronecker products can very quickly make huge graphs with power law
-- distributions.  These are handy synthetic graphs to mimic certain
-- statistical edge distributions common in sparse graph problems:
select nvals(kronpower(s, 4)) from test_fixture;
┌──────────┐
│  nvals   │
├──────────┤
│ 43046721 │
└──────────┘
(1 row)

-- ## Transpose
--
-- A matrix can be transposed with the `transpose()` function:
select print(transpose(a)) from test_fixture;
┌────────────────────┐
│       print        │
├────────────────────┤
│      0  1  2  3   ↵│
│    ────────────   ↵│
│  0│ 36            ↵│
│  1│ 21   127      ↵│
│  2│    40         ↵│
│  3│               ↵│
│                    │
└────────────────────┘
(1 row)

-- ## Apply
--
-- `apply` takes an operator of type `unaryop` and applies it to every
-- element of the matrix.  The 'ainv_int32' returned the additive
-- inverse (the negative value for integers) of every element:
select print(a) as a, unaryop, print(apply(a, unaryop)) as applied from test_fixture;
┌────────────────────┬────────────┬────────────────────┐
│         a          │  unaryop   │      applied       │
├────────────────────┼────────────┼────────────────────┤
│      0  1  2  3   ↵│ ainv_int32 │      0  1  2  3   ↵│
│    ────────────   ↵│            │    ────────────   ↵│
│  0│ 36 21         ↵│            │  0│-36-21         ↵│
│  1│       40      ↵│            │  1│      -40      ↵│
│  2│   127         ↵│            │  2│   -12         ↵│
│  3│               ↵│            │  3│               ↵│
│                    │            │                    │
└────────────────────┴────────────┴────────────────────┘
(1 row)

-- ## SuiteSparse Info
--
-- The `info` function returns a descripton of the matrix from
-- SuiteSparse.
select info(a) from test_fixture;
┌──────────────────────────────────────────────┐
│                     info                     │
├──────────────────────────────────────────────┤
│                                             ↵│
│   4x4 GraphBLAS int8_t matrix, bitmap by row↵│
│   A->matrix, 4 entries, memory: 272 bytes   ↵│
│                                             ↵│
│                                              │
└──────────────────────────────────────────────┘
(1 row)

-- ## Matrix Duplication
--
-- The `dup` function duplicates a matrix returning a new matrix
-- object with the same values:
select dup(a) from test_fixture;
┌────────────────┐
│      dup       │
├────────────────┤
│ int8(4:4)[   ] │
└────────────────┘
(1 row)

-- ## Work Completion
--
-- The `wait` method is used to "complete" a matrix, which may have
-- pending operations waiting to be performed when using the default
-- SuiteSparse non-blocking mode.  As a side effect, wait will sort
-- the elements of the input:
select wait('int32[2:2:2 3:3:3 1:1:1]'::matrix);
┌──────────────────────────┐
│           wait           │
├──────────────────────────┤
│ int32[1:1:1 2:2:2 3:3:3] │
└──────────────────────────┘
(1 row)

-- The `clear` function clears the matrix of all elements and returns
-- the same object, but empty.  The dimensions do not change:
-- ## Clearing Matrices
--
select clear('int32[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ clear │
├───────┤
│ int32 │
└───────┘
(1 row)

-- ## Extra tests
--
-- This documentation also forms the basis for the onesparse tests,
-- These tests run the documentation against a live server, all the
-- above results are automatically generated.
select nrows('int32(10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nrows │
├───────┤
│    10 │
└───────┘
(1 row)

select ncols('int32(10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌─────────────────────┐
│        ncols        │
├─────────────────────┤
│ 1152921504606846976 │
└─────────────────────┘
(1 row)

select nvals('int32(10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nvals │
├───────┤
│     3 │
└───────┘
(1 row)

select nrows('int32(10:)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nrows │
├───────┤
│    10 │
└───────┘
(1 row)

select ncols('int32(10:)[1:1:1 2:2:2 3:3:3]'::matrix);
┌─────────────────────┐
│        ncols        │
├─────────────────────┤
│ 1152921504606846976 │
└─────────────────────┘
(1 row)

select nvals('int32(10:)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nvals │
├───────┤
│     3 │
└───────┘
(1 row)

select nrows('int32(:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌─────────────────────┐
│        nrows        │
├─────────────────────┤
│ 1152921504606846976 │
└─────────────────────┘
(1 row)

select ncols('int32(:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ ncols │
├───────┤
│    10 │
└───────┘
(1 row)

select nvals('int32(:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nvals │
├───────┤
│     3 │
└───────┘
(1 row)

select nrows('int32(10:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nrows │
├───────┤
│    10 │
└───────┘
(1 row)

select ncols('int32(10:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ ncols │
├───────┤
│    10 │
└───────┘
(1 row)

select nvals('int32(10:10)[1:1:1 2:2:2 3:3:3]'::matrix);
┌───────┐
│ nvals │
├───────┤
│     3 │
└───────┘
(1 row)

