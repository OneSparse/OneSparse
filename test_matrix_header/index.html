
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../test_examples_header/">
      
      
        <link rel="next" href="../test_vector_header/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.41">
    
    
      
        <title>Matrix - OneSparse</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#matrix" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OneSparse" class="md-header__button md-logo" aria-label="OneSparse" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OneSparse
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Matrix
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OneSparse" class="md-nav__button md-logo" aria-label="OneSparse" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OneSparse
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Demo
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_examples_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Matrix
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Matrix
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matrices-and-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      Matrices and Graphs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawing-matrices-and-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      Drawing Matrices and Vectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Random Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#empty-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Empty Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix dimensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elements" class="md-nav__link">
    <span class="md-ellipsis">
      Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    <span class="md-ellipsis">
      Equality
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-and-getting-individual-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Setting and Getting individual Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-addition" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Addition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-union" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Union
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reduction" class="md-nav__link">
    <span class="md-ellipsis">
      Reduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-matrix-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Matrix Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-vector-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Vector Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-matrix-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Matrix Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing Operators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kronecker" class="md-nav__link">
    <span class="md-ellipsis">
      Kronecker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kronecker-power" class="md-nav__link">
    <span class="md-ellipsis">
      Kronecker Power
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transpose" class="md-nav__link">
    <span class="md-ellipsis">
      Transpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apply" class="md-nav__link">
    <span class="md-ellipsis">
      Apply
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suitesparse-info" class="md-nav__link">
    <span class="md-ellipsis">
      SuiteSparse Info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-duplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Duplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-completion" class="md-nav__link">
    <span class="md-ellipsis">
      Work Completion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clearing-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Clearing Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Extra tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_vector_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_scalar_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scalar
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_semiring_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Semiring
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_monoid_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monoid
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_binaryop_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BinaryOp
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_indexunaryop_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IndexUnaryOp
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_unaryop_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UnaryOp
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_descriptor_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descriptor
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_type_header/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matrices-and-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      Matrices and Graphs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawing-matrices-and-vectors" class="md-nav__link">
    <span class="md-ellipsis">
      Drawing Matrices and Vectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Random Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#empty-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Empty Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-dimensions" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix dimensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elements" class="md-nav__link">
    <span class="md-ellipsis">
      Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    <span class="md-ellipsis">
      Equality
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-and-getting-individual-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Setting and Getting individual Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-addition" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Addition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elementwise-union" class="md-nav__link">
    <span class="md-ellipsis">
      Elementwise Union
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reduction" class="md-nav__link">
    <span class="md-ellipsis">
      Reduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-matrix-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Matrix Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-vector-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Vector Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-matrix-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Matrix Multiplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing Elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing Operators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kronecker" class="md-nav__link">
    <span class="md-ellipsis">
      Kronecker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kronecker-power" class="md-nav__link">
    <span class="md-ellipsis">
      Kronecker Power
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transpose" class="md-nav__link">
    <span class="md-ellipsis">
      Transpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apply" class="md-nav__link">
    <span class="md-ellipsis">
      Apply
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suitesparse-info" class="md-nav__link">
    <span class="md-ellipsis">
      SuiteSparse Info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matrix-duplication" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix Duplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-completion" class="md-nav__link">
    <span class="md-ellipsis">
      Work Completion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clearing-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Clearing Matrices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Extra tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>\pset linestyle unicode
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>\pset border 2
</span></code></pre></div>
<h1 id="matrix">Matrix</h1>
<p>This documentation is also tests for the code, the examples below
show the literal output of these statements from Postgres.</p>
<p>Some setup to make sure the extension is installed.
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>set client_min_messages = &#39;WARNING&#39;; -- pragma:hide
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>create extension if not exists onesparse;
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>\o /dev/null
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>\set ECHO none
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>\i sql/fixtures.sql
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>\set ECHO all
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>\o
</span></code></pre></div>
OneSparse wraps the
<a href="http://faculty.cse.tamu.edu/davis/GraphBLAS.html">SuiteSparse:GraphBLAS</a>
library and extends Postgres by adding new types and functions that
allow you to do sparse and dense linear algebra in Postgres.  This
is similar to functionality packages like <code>numpy</code> and
<code>scipy.sparse</code> bring to Python.</p>
<p>While a full grasp of the GraphBLAS API is not necessary to follow
along with this guide there are many details that are not spelled
out in great details here.  For complete details on the API and
expected behaviors, see the <a href="https://github.com/DrTimothyAldenDavis/SuiteSparse/blob/dev/GraphBLAS/Doc/GraphBLAS_UserGuide.pdf">SuiteSparse:GraphBLAS User
Guide</a>.</p>
<p>The most fundamenteal object in OneSparse is a Matrix.  A Matrix is
a two dimensional array of data with a certain number of rows <em>m</em>
and columns <em>n</em>.  Typically matrices are very memory hungry data
structures, requiring <code>m * n</code> memory to hold all of the elements.</p>
<p>This limits traditional matrix libraries, because many problems in
linear algebra are <em>sparse</em>.  Not every element is used in the
problem or even definable.  Traditional linear algebra libraries
usually encode sparse matrices into dense matrices by using the
number zero to indicate "nothing", but this approach does not solve
the memory problem.  For matrices with a large number of rows and
columns this means vast areas of memories filled with zeros that
end up being multiplied away, which also wastes time and energy.</p>
<p>OneSparse matrices however are smart, and can adapt to the number
of actually useful elements in a Matrix.  They can be dense or
sparse, the SuiteSparse library will adapt to choose the right
backend format.</p>
<h2 id="matrices-and-graphs">Matrices and Graphs</h2>
<p>Every matrix is a graph, whether you think of it that way or not.
And every graph has a corresponding matrix.  A lot of data that you
put into postgres tables can also describe a graph, and thus a
matrix.  These three different ways of thinking about tables,
graphs, and matrices is one of the core concepts of OneSparse:</p>
<p><img alt="Tables, Graphs, and Matrices" src="../table_graph_matrix.png" /></p>
<p>While SuiteSparse is optimized for processing sparse matrices and
vectors, it also supports optimized kernels for dense objects.  A
dense matrix is just a sparse matrix with all its elements.  In
this case SuiteSparse will automatically store it in a dense
optimal format and use CPUs or GPUs appropriately to process them.</p>
<h2 id="getting-started">Getting Started</h2>
<p>The examples below are all what you would see typing the exact
queries out in <code>psql</code>.  The GraphBLAS API is large, so onesparse is
always contained in the <code>onesparse</code> postgres schema.  For the sake
of brevity, let's set the <code>search_path</code> so that we can just type
<code>matrix</code> instead of <code>onesparse.matrix</code> everywhere.
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>SET search_path TO public,onesparse;
</span></code></pre></div>
If the matrix has bounds, it can be printed to the console if they
are reasonable size, this is useful for debugging and
experimentation:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>select print(&#39;int32(4:4)&#39;::matrix);
</span></code></pre></div>
Note that this matrix is empty, it's not filled with "zeros", it
contains <em>no elements</em>.  The memory needed to hold the matrix
contains only stored elements, if there isn't a value stored at a
given row or column position, no memory is consumed.  This is the
"sparse" in sparse matrix.  This is how it's possible to create an
unbounded row by unbounded column matrix without exhausting memory
trying to allocate <code>2^120</code> entries.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>
</span></code></pre></div>
<h2 id="drawing-matrices-and-vectors">Drawing Matrices and Vectors</h2>
<p>The <code>draw()</code> function turns a matrix into the Graphviz DOT language
that is used to draw graph diagrams:
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>select draw(&#39;int32(4:4)[1:2:1 2:3:2 3:1:3]&#39;::matrix) as draw;
</span></code></pre></div>
Will generate the following diagram:
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>select draw(&#39;int32(4:4)[1:2:1 2:3:2 3:1:3]&#39;::matrix) as draw_source \gset
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>\i sql/draw.sql
</span></code></pre></div>
Let's look at our cast of test objects for the remaining examples.
These objects from the <code>onesparse.test_fixture</code> table.
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>\x
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>select * from test_fixture;
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>\x
</span></code></pre></div></p>
<p>Here are a couple of sparse matrices from the test_fixture table.
We'll call them <code>a</code> and <code>b</code> in these docs:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>select print(a) as a, print(b) as b from test_fixture;
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>select draw(a) as twocol_a_source, draw(b) as twocol_b_source from test_fixture \gset
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>\i sql/twocol.sql
</span></code></pre></div>
Here are some sparse test vectors, they will be used for some of
the examples below:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>select print(u) as u, print(v) as v from test_fixture;
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>select draw(u) as twocol_a_source, draw(v) as twocol_b_source from test_fixture \gset
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>\i sql/twocol.sql
</span></code></pre></div>
There is also an example "dense" matrix named 'd':</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>select print(d) from test_fixture;
</span></code></pre></div>
One way of thinking about a "dense" matrix is a fully connected
graph, these can be constructed with the <code>dense_matrix()</code> function:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>select draw(dense_matrix(4, 4, 1)) as draw_source from test_fixture \gset
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>\i sql/draw.sql
</span></code></pre></div>
And another matrix named 's' which is a Sierpinsky Graph, which
we'll show off a bit later.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>select print(s) from test_fixture;
</span></code></pre></div>
<h2 id="random-matrices">Random Matrices</h2>
<p><code>random_matrix</code> will generate a random matrix provided the type,
number of rows, number of columns, and the number of (approximate)
values, an optional max value, and an optional random seed for
deterministic generation:
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>select print(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42)) as random_matrix;
</span></code></pre></div>
This random matrix is also a random <em>graph</em>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>select draw(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42)) as draw_source \gset
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>\i sql/draw.sql
</span></code></pre></div>
<h2 id="empty-matrices">Empty Matrices</h2>
<p>The <code>matrix</code> data type wraps a SuiteSparse GrB_Matrix handle and
delegates functions from SQL to the library through instances of
this type.</p>
<p>An empty matrix can be constructed many ways, but one of the
simplest is casting a type code to the matrix type.  In this case
<code>int32</code> means the SuiteSparse type <code>GrB_INT32</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>select &#39;int32&#39;::matrix;
</span></code></pre></div>
Another way to create an empty matrix is to use the <code>matrix()</code>
constructor function:
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>select matrix(&#39;int32&#39;);
</span></code></pre></div></p>
<h2 id="matrix-dimensions">Matrix dimensions</h2>
<p>The above matrices are "unbounded", they do not have a fixed number
of rows and/or columns.  The default possible number of rows and
columns is defined by the SuiteSparse library to be <code>GrB_INDEX_MAX</code>
which is <code>2^60</code> power indexes.  For the purposes of this
documentation this will be referred to as <code>INDEX_MAX</code> and matrices
and vector dimensions that are <code>INDEX_MAX</code> in size are reffered to
as "unbounded".</p>
<p>For matrices with known dimensions, the dimensions can be provided
in parentesis after the type code.  Here a 4 row by 4 column
matrix is created:
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>select &#39;int32(4:4)&#39;::matrix;
</span></code></pre></div>
Another way to make a new matrix is with the <code>matrix</code> constructor
function.
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>select matrix(&#39;int32&#39;, 4, 4);
</span></code></pre></div>
Either dimension can be ommited, this creates a 4 row by unbounded
column matrix.
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>select &#39;int32(4:)&#39;::matrix;
</span></code></pre></div>
This creates a unbounded row by 4 column matrix.
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>select &#39;int32(:4)&#39;::matrix;
</span></code></pre></div>
All graphblas operations are exposed by a series of functions and
operators.  Here we see three very common operations, returning the
number of rows, the number of columns, and the number of store
values.
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>select nrows(&#39;int32&#39;::matrix),
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>       ncols(&#39;int32&#39;::matrix),
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>       nvals(&#39;int32&#39;::matrix);
</span></code></pre></div>
Above you can see the matrix has unbounded rows and columns (the
very large number is the number of <em>possible</em> entries).  And the
number of stored values is zero.  These matrices are empty, they
contain no elements.</p>
<p>Values can be specified after the <code>type(dimension)</code> prefix as an
array of elements between square brackets.  Empty brackets imply no
elements, so empty square brackets are the same as no square
brackets as above:
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>select nrows(&#39;int32[]&#39;::matrix),
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>       ncols(&#39;int32[]&#39;::matrix),
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>       nvals(&#39;int32[]&#39;::matrix);
</span></code></pre></div>
Elements are specified between square brackets are coordinates of
'row_id:column_id:value' separated by spaces:
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>select &#39;int32[1:2:1 2:3:2 3:1:3]&#39;::matrix,
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>       &#39;int32(4:)[1:2:1 2:3:2 3:1:3]&#39;::matrix,
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>       &#39;int32(:4)[1:2:1 2:3:2 3:3:1]&#39;::matrix;
</span></code></pre></div></p>
<h2 id="elements">Elements</h2>
<p>All the elements in a matrix can be iterated with the <code>elements()</code>
function:
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>select * from elements((select a from test_fixture));
</span></code></pre></div>
The inverse operation of constructing matrices from rows can be
done with <code>matrix_agg()</code>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>select matrix_agg(i, i, i) as unbound_matrix from generate_series(0, 10) as i;
</span></code></pre></div>
Aggregate matrices are always unbounded so use <code>resize()</code> to bound
the matrix:
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>select print(resize(matrix_agg(i, i, i), 10, 10)) as bound_matrix from generate_series(0, 10) as i;
</span></code></pre></div></p>
<h2 id="equality">Equality</h2>
<p>Two matrices can be compared for equality with the '=' and '!=' operators:
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>select a != b as &quot;a != b&quot;, a = b as &quot;a = b&quot;, b = a as &quot;b = a&quot;, b = b as &quot;b = b&quot; from test_fixture;
</span></code></pre></div></p>
<h2 id="setting-and-getting-individual-elements">Setting and Getting individual Elements</h2>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>
</span></code></pre></div>
Elements can be set individually with <code>set_element</code>, the modified
input is returned:
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>select print(set_element(a, 1, 1, 1)) as set_element from test_fixture;
</span></code></pre></div>
Scalar elements can be extracted individually with <code>get_element</code>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>select get_element(a, 3, 2) as get_element from test_fixture;
</span></code></pre></div>
If an element does exist <code>get_element</code> will return an "empty"
scalar:
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>select get_element(a, 3, 3) as get_element from test_fixture;
</span></code></pre></div></p>
<h2 id="elementwise-addition">Elementwise Addition</h2>
<p>The GraphBLAS API has elementwise operations on matrices that
operate pairs of matrices.  <code>eadd</code> computes the element-wise
“addition” of two matrices a and b, element-wise using any binary
operator.  The "add" in the name means that the union of both
graphs is taken; elements present on both sides of the operation
are included in the result.
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>select print(a) as a, binaryop, print(b) as b, print(eadd(a, b, binaryop)) as &quot;eadd(a, b, binaryop)&quot; from test_fixture;
</span></code></pre></div>
Eadd can also be accomplished with binary operators specific to
OneSparse.  Different binaryops are passed to eadd to do different
elementwise operations:
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>select print(a |+ b) as &quot;a |+ b&quot;, print(a |- b) as &quot;a |- b&quot;, print(a |* b) as &quot;a |* b&quot;, print(a |/ b) as &quot;a |/ b&quot; from test_fixture;
</span></code></pre></div>
From a graph standpoint, elementwise addition can be seen as the
merging ("union") of two graphs, such that the result has edges
from both graphs.  Any edges that occur in both graphs are merged
with the provided binary operator.
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(eadd(a, b, binaryop)) as binop_c_source from test_fixture \gset
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>\i sql/binop.sql
</span></code></pre></div></p>
<h2 id="elementwise-multiplication">Elementwise Multiplication</h2>
<p><code>emult</code> multiplies elements of two matrices, taking only the
intersection of common elements in both matrices, if an element is
missing from either the left or right side, it is ommited from the
result:
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>select print(a) as a, binaryop, print(b) as b, print(emult(a, b, binaryop)) as &quot;emult(a, b, binaryop)&quot; from test_fixture;
</span></code></pre></div>
Emult can also be accomplished with binary operators specific to
OneSparse.  Different binaryops are passed to emult to do different
elementwise operations:
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>select print(a &amp;+ b) as &quot;a &amp;+ b&quot;, print(a &amp;- b) as &quot;a &amp;- b&quot;, print(a &amp;* b) as &quot;a &amp;* b&quot;, print(a &amp;/ b) as &quot;a &amp;/ b&quot; from test_fixture;
</span></code></pre></div>
From a graph standpoint, elementwise multiplication can be seen as
the intersection of two graphs, such that the result has edges that
are only present in both graphs.  The edges are combined with the
provided binary operator.
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(emult(a, b, binaryop)) as binop_c_source from test_fixture \gset
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>\i sql/binop.sql
</span></code></pre></div></p>
<h2 id="elementwise-union">Elementwise Union</h2>
<p><code>eunion</code> is like <code>eadd</code> but differs in how the binary op is
applied. A pair of scalars, <code>alpha</code> and <code>beta</code> define the inputs to
the operator when entries are present in one matrix but not the
other.
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>select print(a) as a, binaryop, print(b) as b, print(eunion(a, 3::scalar, b, 4::scalar, binaryop)) as &quot;eunion(a, 3::scalar, b, 4::scalar, binaryop)&quot; from test_fixture;
</span></code></pre></div>
From a graph standpoint, elementwise union is very similar to
<code>eadd()</code>, and can be seen as the merging ("union") of two graphs,
such that the result has edges from both graphs.  Any edges that
occur in both graphs are merged with the provided binary operator.
If an edge occurs in a but not in b, it is combined with the
scalar <code>alpha</code>, if the edge occurs in the b but not in a, then
the edge is combined with scalar <code>beta</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(eunion(a, 3::scalar, b, 4::scalar, binaryop)) as binop_c_source from test_fixture \gset
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>\i sql/binop.sql
</span></code></pre></div></p>
<h2 id="reduction">Reduction</h2>
<p>The entire matrix can be reduced to a scalar value:
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>select print(a) as a, &#39;plus_monoid_int32&#39; as monoid, reduce_scalar(a) from test_fixture;
</span></code></pre></div>
The entire matrix can be reduced to a scalar value with a provided
monoid that changes the reduction operation:
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>select print(a) as a, &#39;min_monoid_int32&#39; as monoid, reduce_scalar(a, &#39;min_monoid_int32&#39;) from test_fixture;
</span></code></pre></div>
The matrix can also be reduced to a column vector:
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>select print(a) as a, &#39;plus_monoid_int32&#39; as monoid, print(reduce_cols(a)) as reduce_cols from test_fixture;
</span></code></pre></div>
To reduce a row vector:
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>select print(a) as a, &#39;plus_monoid_int32&#39; as monoid, print(reduce_rows(a)) as reduce_rows from test_fixture;
</span></code></pre></div></p>
<h2 id="matrix-matrix-multiplication">Matrix Matrix Multiplication</h2>
<p>Matrix Multiplication is the heart of linear algebra.  All matrix
multiplication happens over a semiring.  For the most common form
of matrix multiplication, the outer opperation is to multiply
coresponding elements with the "times" operator and then reduce
those products with the "plus" operator.  This is called the
<code>plus_times</code> semiring:
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>select print(a) as a, semiring, print(b) as b, print(mxm(a, b)) as &quot;mxm(a, b)&quot; from test_fixture;
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>select draw(a) as binop_a_source, draw(b) as binop_b_source, draw(mxm(a, b)) as binop_c_source from test_fixture \gset
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>\i sql/binop.sql
</span></code></pre></div>
AxB can also be done with the <code>@</code> operator, mimicking the Python
syntax.  The default semiring for numeric types is <code>plus_times</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>select print(a) as a, &#39;@&#39; as &quot;@&quot;, print(b) as b, print(a @ b) as &quot;a @ b&quot; from test_fixture;
</span></code></pre></div></p>
<h2 id="matrix-vector-multiplication">Matrix Vector Multiplication</h2>
<p>Matrices can be multipled by vectors on the right taking the linear
combination of the matrices columns using the vectors elements as
coefficients:
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>select print(a) as a, &#39;@&#39; as &quot;@&quot;, semiring, print(u) as u, print(mxv(a, u)) as &quot;mxv(a, u)&quot; from test_fixture;
</span></code></pre></div>
From a graph standpoint, matrix vector multiplication is used to
"pull" back to adjacent nodes from their incoming edges.  When
iterated, it forms the basis for working back along incoming links.
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>select draw(a) as binop_a_source, draw(u) as binop_b_source, draw(mxv(a, u)) as binop_c_source from test_fixture \gset
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>\i sql/binop.sql
</span></code></pre></div>
'mxv' is also supported by the <code>@</code> operator:
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>select print(a) as a, &#39;@&#39; as &quot;@&quot;, print(u) as u, print(a @ u) as &quot;a @ u&quot; from test_fixture;
</span></code></pre></div></p>
<h2 id="vector-matrix-multiplication">Vector Matrix Multiplication</h2>
<p>Matrices can be multipled by vectors on the right taking the linear
combination of the matrices rows using the vectors elements as
coefficients:
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>select print(v) as v, semiring, print(b) as b, print(vxm(v, b, semiring)) as &quot;vxm(v, b, semiring)&quot; from test_fixture;
</span></code></pre></div>
From a graph standpoint, vector matrix multiplication is used to
"push" forward to adjacent nodes from their outgoing edges.  When
iterated, it forms the basis for working forward along outgoing
edges.
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>select draw(v) as binop_a_source, draw(b) as binop_b_source, draw(vxm(v, b)) as binop_c_source from test_fixture \gset
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>\i sql/binop.sql
</span></code></pre></div>
'vxm' is also supported by the <code>@</code> operator:
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>select print(v) as v, &#39;@&#39; as &quot;@&quot;, print(b) as b, print(v @ b) as &quot;v @ b&quot; from test_fixture;
</span></code></pre></div></p>
<h2 id="choosing-elements">Choosing Elements</h2>
<p>The <code>choose</code> method calls the <code>GrB_select()</code> API function.  The
name <code>choose</code> was chosen not to conflict with the SQL keyword
<code>select</code>.  Selection provides a conditional operator called an
<code>indexunaryop</code> and a parameter for the operator to use to compare
elements in the matrix.  Below, all elements with values greater
than 1 are returned:
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>select print(a) as a, indexunaryop, print(choose(a, indexunaryop, 1)) as selected from test_fixture;
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>select draw(a) as uop_a_source, draw(choose(a, indexunaryop, 1)) as uop_b_source from test_fixture \gset
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>\i sql/uop.sql
</span></code></pre></div></p>
<h2 id="choosing-operators">Choosing Operators</h2>
<p>Selection can also be done with scalars and operators:p
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>select print(a &gt; 1) as &quot;a &gt; 1&quot;, print(a &gt;= 1) as &quot;a &gt;= 1&quot;, print(a &lt; 1) as &quot;a &lt; 1&quot;, print(a &lt;= 1) as &quot;a &lt;= 1&quot; from test_fixture;
</span></code></pre></div>
A useful select operator is <code>triu</code>, it select only upper triangular
values, this turns your graph into a direct acyclic graph (DAG) by
removing all the links "back" from higher number nodes to lower.
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>select print(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42)) as matrix,
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>       print(choose(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42), &#39;triu&#39;, 0)) as triu from test_fixture;
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>select draw(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42)) as uop_a_source,
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>       draw(choose(random_matrix(8, 8, 16, seed=&gt;0.42, max=&gt;42), &#39;triu&#39;, 0)) as uop_b_source
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>       from test_fixture \gset
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>\i sql/uop.sql
</span></code></pre></div></p>
<h2 id="kronecker">Kronecker</h2>
<p>The <code>kronecker()</code> function takes two input matrices, and replaces
every element in the second matrix with a new submatrix of the
first.  This "expands" the matrix exponentially.  This is useful
for constructing synthetic graphs with specific power law
distributions.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>select print(s) as s, semiring, print(s) as s, print(kronecker(s, s, semiring)) as kronecker from test_fixture;
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>select draw(s) as binop_a_source, draw(s) as binop_b_source, draw(kronecker(s, s, semiring)) as binop_c_source from test_fixture \gset
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>\i sql/binop.sql
</span></code></pre></div>
<h2 id="kronecker-power">Kronecker Power</h2>
<p>There's a special function for exponentiating a matrix to itself a
certain number of times, <code>kronpower</code>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>select print(kronpower(s, 2)) from test_fixture;
</span></code></pre></div>
Kronecker products can very quickly make huge graphs with power law
distributions.  These are handy synthetic graphs to mimic certain
statistical edge distributions common in sparse graph problems:
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>select nvals(kronpower(s, 4)) from test_fixture;
</span></code></pre></div></p>
<h2 id="transpose">Transpose</h2>
<p>A matrix can be transposed with the <code>transpose()</code> function:
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>select print(transpose(a)) from test_fixture;
</span></code></pre></div></p>
<h2 id="apply">Apply</h2>
<p><code>apply</code> takes an operator of type <code>unaryop</code> and applies it to every
element of the matrix.  The 'ainv_int32' returned the additive
inverse (the negative value for integers) of every element:
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>select print(a) as a, unaryop, print(apply(a, unaryop)) as applied from test_fixture;
</span></code></pre></div></p>
<h2 id="suitesparse-info">SuiteSparse Info</h2>
<p>The <code>info</code> function returns a descripton of the matrix from
SuiteSparse.
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>select info(a) from test_fixture;
</span></code></pre></div></p>
<h2 id="matrix-duplication">Matrix Duplication</h2>
<p>The <code>dup</code> function duplicates a matrix returning a new matrix
object with the same values:
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>select dup(a) from test_fixture;
</span></code></pre></div></p>
<h2 id="work-completion">Work Completion</h2>
<p>The <code>wait</code> method is used to "complete" a matrix, which may have
pending operations waiting to be performed when using the default
SuiteSparse non-blocking mode.  As a side effect, wait will sort
the elements of the input:
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>select wait(&#39;int32[2:2:2 3:3:3 1:1:1]&#39;::matrix);
</span></code></pre></div>
The <code>clear</code> function clears the matrix of all elements and returns
the same object, but empty.  The dimensions do not change:
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>
</span></code></pre></div></p>
<h2 id="clearing-matrices">Clearing Matrices</h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>select clear(&#39;int32[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span></code></pre></div>
<h2 id="extra-tests">Extra tests</h2>
<p>This documentation also forms the basis for the onesparse tests,
These tests run the documentation against a live server, all the
above results are automatically generated.
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>select nrows(&#39;int32(10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>select ncols(&#39;int32(10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>select nvals(&#39;int32(10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>select nrows(&#39;int32(10:)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>select ncols(&#39;int32(10:)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>select nvals(&#39;int32(10:)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>select nrows(&#39;int32(:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>select ncols(&#39;int32(:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>select nvals(&#39;int32(:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>select nrows(&#39;int32(10:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>select ncols(&#39;int32(10:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>select nvals(&#39;int32(10:10)[1:1:1 2:2:2 3:3:3]&#39;::matrix);
</span></code></pre></div></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>